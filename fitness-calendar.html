<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>12-Month Fat Loss Program</title>
    
    <!-- PWA Meta Tags -->
    <meta name="description" content="Weekly training and nutrition calendar for sustainable weight loss - 110kg to 91kg in 12 months">
    <meta name="theme-color" content="#e85d25">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Fat Loss Plan">
    <meta name="mobile-web-app-capable" content="yes">
    
    <!-- Manifest -->
    <link rel="manifest" href="manifest.json">
    
    <!-- Icons -->
    <link rel="icon" type="image/png" sizes="192x192" href="icon-192.png">
    <link rel="icon" type="image/png" sizes="512x512" href="icon-512.png">
    <link rel="apple-touch-icon" href="icon-192.png">
    
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600;700&family=Source+Sans+3:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Light theme (default) */
            --bg-dark: #f5f5f7;
            --bg-card: #ffffff;
            --bg-card-hover: #fafafa;
            --accent-orange: #e85d25;
            --accent-yellow: #d4a012;
            --accent-green: #0d9488;
            --accent-purple: #9333ea;
            --accent-blue: #2563eb;
            --text-primary: #1a1a1a;
            --text-secondary: #555555;
            --text-muted: #888888;
            --border-subtle: #e0e0e0;
            --shadow-color: rgba(0,0,0,0.08);
            --modal-overlay: rgba(0,0,0,0.5);
            --section-bg: rgba(0,0,0,0.02);
        }

        [data-theme="dark"] {
            --bg-dark: #0d0d0d;
            --bg-card: #1a1a1a;
            --bg-card-hover: #252525;
            --accent-orange: #ff6b35;
            --accent-yellow: #f7c948;
            --accent-green: #4ecdc4;
            --accent-purple: #a855f7;
            --accent-blue: #3b82f6;
            --text-primary: #ffffff;
            --text-secondary: #a0a0a0;
            --text-muted: #666666;
            --border-subtle: #333333;
            --shadow-color: rgba(0,0,0,0.3);
            --modal-overlay: rgba(0,0,0,0.9);
            --section-bg: rgba(255,255,255,0.02);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Source Sans 3', sans-serif;
            background: var(--bg-dark);
            color: var(--text-primary);
            min-height: 100vh;
            line-height: 1.6;
        }

        /* Header */
        .header {
            padding: 2rem;
            text-align: center;
            background: linear-gradient(180deg, rgba(232,93,37,0.08) 0%, transparent 100%);
            border-bottom: 1px solid var(--border-subtle);
        }

        [data-theme="dark"] .header {
            background: linear-gradient(180deg, rgba(255,107,53,0.1) 0%, transparent 100%);
        }

        .header h1 {
            font-family: 'Oswald', sans-serif;
            font-size: 2.5rem;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            background: linear-gradient(135deg, var(--accent-orange), var(--accent-yellow));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 0.5rem;
        }

        .header p {
            color: var(--text-secondary);
            font-size: 1.1rem;
        }

        .theme-toggle-wrapper {
            position: absolute;
            top: 1.5rem;
            right: 1.5rem;
        }

        .theme-toggle {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 50%;
            width: 44px;
            height: 44px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            color: var(--text-secondary);
        }

        .theme-toggle:hover {
            border-color: var(--accent-orange);
            color: var(--accent-orange);
            transform: rotate(15deg);
        }

        .theme-toggle svg {
            width: 20px;
            height: 20px;
        }

        .theme-toggle .moon-icon {
            display: none;
        }

        [data-theme="dark"] .theme-toggle .sun-icon {
            display: none;
        }

        [data-theme="dark"] .theme-toggle .moon-icon {
            display: block;
        }

        .header {
            position: relative;
        }

        .stats-bar {
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-top: 1.5rem;
            flex-wrap: wrap;
        }

        .stat {
            text-align: center;
            padding: 0.75rem 1.5rem;
            background: var(--bg-card);
            border-radius: 8px;
            border: 1px solid var(--border-subtle);
            box-shadow: 0 2px 8px var(--shadow-color);
        }

        .stat-value {
            font-family: 'Oswald', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--accent-orange);
        }

        .stat-label {
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
        }

        /* Calendar Grid */
        .calendar-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem;
        }

        .week-label {
            font-family: 'Oswald', sans-serif;
            font-size: 1.25rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--text-secondary);
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .week-label::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--border-subtle);
        }

        .calendar-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 1rem;
            margin-bottom: 2rem;
        }

        @media (max-width: 1200px) {
            .calendar-grid {
                grid-template-columns: repeat(4, 1fr);
            }
        }

        @media (max-width: 900px) {
            .calendar-grid {
                grid-template-columns: repeat(3, 1fr);
            }
        }

        @media (max-width: 768px) {
            .calendar-grid {
                grid-template-columns: repeat(2, 1fr);
            }

            .header h1 {
                font-size: 1.75rem;
            }

            .header p {
                font-size: 0.95rem;
            }

            .stats-bar {
                gap: 0.75rem;
            }

            .stat {
                padding: 0.5rem 1rem;
            }

            .stat-value {
                font-size: 1.1rem;
            }

            .stat-label {
                font-size: 0.65rem;
            }

            .golden-rules {
                padding: 1rem;
            }

            .golden-rules h3 {
                font-size: 0.85rem;
            }

            .rules-grid {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }

            .rule {
                font-size: 0.8rem;
            }

            .theme-toggle-wrapper {
                top: 1rem;
                right: 1rem;
            }

            .theme-toggle {
                width: 38px;
                height: 38px;
            }
        }

        @media (max-width: 480px) {
            .calendar-grid {
                grid-template-columns: 1fr;
                gap: 0.75rem;
            }

            .header {
                padding: 1.5rem 1rem;
            }

            .header h1 {
                font-size: 1.5rem;
                padding-right: 2.5rem;
            }

            .header p {
                font-size: 0.85rem;
            }

            .stats-bar {
                flex-direction: column;
                align-items: stretch;
                gap: 0.5rem;
            }

            .stat {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 0.75rem 1rem;
            }

            .stat-value {
                font-size: 1.2rem;
            }

            .stat-label {
                font-size: 0.7rem;
            }

            .calendar-container {
                padding: 1rem;
            }

            .week-label {
                font-size: 1rem;
            }

            .day-card {
                border-radius: 10px;
            }

            .day-header {
                padding: 0.75rem;
            }

            .day-name {
                font-size: 1.1rem;
            }

            .day-content {
                padding: 0.75rem;
            }

            .workout-title {
                font-size: 0.9rem;
            }

            .footer {
                padding: 1.5rem 1rem;
                font-size: 0.8rem;
            }

            .footer p {
                line-height: 1.5;
            }
        }

        /* Day Card */
        .day-card {
            background: var(--bg-card);
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 1px solid var(--border-subtle);
            position: relative;
            box-shadow: 0 2px 8px var(--shadow-color);
        }

        .day-card:hover {
            transform: translateY(-4px);
            background: var(--bg-card-hover);
            border-color: var(--accent-orange);
            box-shadow: 0 8px 32px var(--shadow-color);
        }

        .day-header {
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-subtle);
        }

        .day-name {
            font-family: 'Oswald', sans-serif;
            font-size: 1.25rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .day-type {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-weight: 600;
        }

        .day-type.gym { background: var(--accent-orange); color: #000; }
        .day-type.cardio { background: var(--accent-green); color: #000; }
        .day-type.recovery { background: var(--accent-purple); color: #fff; }

        .day-content {
            padding: 1rem;
        }

        .workout-title {
            font-family: 'Oswald', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
            line-height: 1.3;
        }

        .workout-duration {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 1rem;
        }

        .workout-duration svg {
            width: 14px;
            height: 14px;
            fill: var(--accent-orange);
        }

        .diet-preview {
            background: var(--section-bg);
            border-radius: 8px;
            padding: 0.75rem;
            margin-top: 0.5rem;
        }

        .diet-label {
            font-size: 0.65rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--accent-yellow);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .macros {
            display: flex;
            gap: 0.75rem;
        }

        .macro {
            font-size: 0.75rem;
            color: var(--text-secondary);
        }

        .macro strong {
            color: var(--text-primary);
        }

        .click-hint {
            text-align: center;
            padding: 0.75rem;
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            border-top: 1px solid var(--border-subtle);
            transition: color 0.3s ease;
        }

        .day-card:hover .click-hint {
            color: var(--accent-orange);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--modal-overlay);
            display: none;
            justify-content: center;
            align-items: flex-start;
            padding: 2rem;
            overflow-y: auto;
            z-index: 1000;
            -webkit-overflow-scrolling: touch;
        }

        .modal-overlay.active {
            display: flex;
        }

        /* Prevent body scroll when modal is open */
        body.modal-open {
            overflow: hidden;
            position: fixed;
            width: 100%;
        }

        .modal {
            background: var(--bg-card);
            border-radius: 16px;
            max-width: 1100px;
            width: 100%;
            margin: 2rem auto;
            border: 1px solid var(--border-subtle);
            animation: modalSlide 0.3s ease;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        }

        @keyframes modalSlide {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .modal-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, rgba(232,93,37,0.08) 0%, transparent 100%);
        }

        [data-theme="dark"] .modal-header {
            background: linear-gradient(135deg, rgba(255,107,53,0.1) 0%, transparent 100%);
        }

        .modal-header h2 {
            font-family: 'Oswald', sans-serif;
            font-size: 1.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .modal-header .day-type {
            font-size: 0.8rem;
            padding: 0.5rem 1rem;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            padding: 0.75rem;
            transition: color 0.3s ease;
            border-radius: 8px;
            min-width: 44px;
            min-height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-btn:hover {
            color: var(--accent-orange);
            background: var(--section-bg);
        }

        .close-btn svg {
            width: 24px;
            height: 24px;
        }

        .modal-body {
            padding: 1rem;
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        @media (min-width: 769px) {
            .modal-body {
                padding: 2rem;
                display: grid;
                grid-template-columns: 1fr 1.2fr;
                gap: 2rem;
            }
        }

        @media (max-width: 768px) {
            .modal-body {
                flex-direction: column;
            }

            .modal {
                margin: 1rem;
                border-radius: 12px;
                max-height: 90vh;
                overflow-y: auto;
            }

            .modal-header {
                padding: 1rem 1.25rem;
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .modal-header h2 {
                font-size: 1.25rem;
            }

            .section {
                padding: 1rem;
            }

            .section-header {
                flex-wrap: wrap;
                gap: 0.5rem;
            }

            .tips-section {
                grid-column: 1;
            }

            .tips-list {
                grid-template-columns: 1fr;
            }

            .nutrition-section {
                max-height: none;
                overflow-y: visible;
                padding-right: 0;
            }

            .meal-image {
                height: 120px;
            }

            .meal-card-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.5rem;
            }

            .meal-card-protein {
                align-self: flex-start;
            }
        }

        @media (max-width: 480px) {
            .modal-overlay {
                padding: 0.5rem;
            }

            .modal {
                margin: 0.5rem;
                border-radius: 10px;
            }

            .modal-header h2 {
                font-size: 1.1rem;
            }

            .modal-header .day-type {
                font-size: 0.65rem;
                padding: 0.3rem 0.6rem;
                margin-left: 0 !important;
            }

            .section {
                padding: 0.75rem;
                border-radius: 8px;
            }

            .section-icon {
                width: 32px;
                height: 32px;
                border-radius: 8px;
            }

            .section-icon svg {
                width: 16px;
                height: 16px;
            }

            .section-title {
                font-size: 0.9rem;
            }

            .workout-block-title {
                font-size: 0.65rem;
            }

            .exercise-list li {
                font-size: 0.8rem;
                flex-wrap: wrap;
                gap: 0.25rem;
            }

            .meal-card {
                border-radius: 8px;
            }

            .meal-image {
                height: 100px;
            }

            .meal-card-content {
                padding: 0.75rem;
            }

            .meal-card-title {
                font-size: 0.9rem;
            }

            .meal-card-description {
                font-size: 0.8rem;
            }

            .recipe-toggle {
                font-size: 0.7rem;
                padding: 0.5rem;
            }

            .recipe-content {
                padding: 0.75rem;
            }

            .ingredients-list li,
            .recipe-instructions {
                font-size: 0.75rem;
            }

            .snacks-section {
                padding: 0.75rem;
            }

            .snack-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.25rem;
            }

            .tip {
                font-size: 0.8rem;
            }

            .tip-icon {
                font-size: 1rem;
            }

            .nutrition-summary {
                padding: 0.75rem;
            }

            .nutrition-summary p {
                font-size: 0.8rem;
            }

            .calories-badge {
                font-size: 0.7rem !important;
            }
        }

        .section {
            background: var(--section-bg);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-subtle);
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.25rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid var(--border-subtle);
        }

        .section-icon {
            width: 40px;
            height: 40px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .section-icon.workout {
            background: linear-gradient(135deg, var(--accent-orange), #ff8c5a);
        }

        .section-icon.nutrition {
            background: linear-gradient(135deg, var(--accent-green), #6ee7de);
        }

        .section-icon svg {
            width: 20px;
            height: 20px;
            fill: #000;
        }

        .section-title {
            font-family: 'Oswald', sans-serif;
            font-size: 1.1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .workout-block {
            margin-bottom: 1.25rem;
        }

        .workout-block:last-child {
            margin-bottom: 0;
        }

        .workout-block-title {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--accent-orange);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .exercise-list {
            list-style: none;
        }

        .exercise-list li {
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-subtle);
            font-size: 0.9rem;
            color: var(--text-secondary);
            display: flex;
            justify-content: space-between;
        }

        .exercise-list li:last-child {
            border-bottom: none;
        }

        .exercise-list li span:last-child {
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .meal-block {
            margin-bottom: 1.25rem;
            padding-bottom: 1.25rem;
            border-bottom: 1px solid var(--border-subtle);
        }

        .meal-block:last-child {
            margin-bottom: 0;
            padding-bottom: 0;
            border-bottom: none;
        }

        .meal-title {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--accent-green);
            margin-bottom: 0.5rem;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
        }

        .meal-title .protein {
            color: var(--accent-yellow);
        }

        .meal-content {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .tips-section {
            grid-column: 1 / -1;
            background: linear-gradient(135deg, rgba(147,51,234,0.08) 0%, rgba(37,99,235,0.08) 100%);
            border-color: var(--accent-purple);
        }

        [data-theme="dark"] .tips-section {
            background: linear-gradient(135deg, rgba(168,85,247,0.1) 0%, rgba(59,130,246,0.1) 100%);
        }

        .tips-section .section-icon {
            background: linear-gradient(135deg, var(--accent-purple), var(--accent-blue));
        }

        .tips-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }

        .tip {
            display: flex;
            gap: 0.75rem;
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .tip-icon {
            color: var(--accent-yellow);
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        /* Expanded Nutrition Styles */
        .nutrition-summary {
            background: linear-gradient(135deg, rgba(13,148,136,0.1) 0%, rgba(78,205,196,0.05) 100%);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1.25rem;
            border-left: 3px solid var(--accent-green);
        }

        .nutrition-summary p {
            font-size: 0.9rem;
            color: var(--text-secondary);
            margin: 0;
        }

        .nutrition-summary .calories-badge {
            display: inline-block;
            background: var(--accent-green);
            color: #000;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            margin-top: 0.5rem;
        }

        .meal-card {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 1rem;
            transition: all 0.3s ease;
        }

        .meal-card:hover {
            border-color: var(--accent-green);
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        .meal-card:last-child {
            margin-bottom: 0;
        }

        .meal-image {
            width: 100%;
            height: 140px;
            object-fit: cover;
            display: block;
        }

        .meal-card-content {
            padding: 1rem;
        }

        .meal-card-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }

        .meal-card-title {
            font-family: 'Oswald', sans-serif;
            font-size: 1rem;
            font-weight: 500;
            color: var(--text-primary);
        }

        .meal-card-time {
            font-size: 0.7rem;
            color: var(--text-muted);
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .meal-card-protein {
            background: var(--accent-yellow);
            color: #000;
            padding: 0.2rem 0.5rem;
            border-radius: 4px;
            font-size: 0.7rem;
            font-weight: 600;
        }

        .meal-card-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
        }

        .recipe-toggle {
            background: var(--section-bg);
            border: 1px solid var(--border-subtle);
            border-radius: 6px;
            padding: 0.5rem 0.75rem;
            font-size: 0.75rem;
            color: var(--accent-orange);
            cursor: pointer;
            width: 100%;
            text-align: left;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.3s ease;
            font-family: 'Source Sans 3', sans-serif;
        }

        .recipe-toggle:hover {
            background: var(--bg-card-hover);
            border-color: var(--accent-orange);
        }

        .recipe-toggle svg {
            width: 16px;
            height: 16px;
            transition: transform 0.3s ease;
        }

        .recipe-toggle.active svg {
            transform: rotate(180deg);
        }

        .recipe-content {
            display: none;
            padding: 1rem;
            background: var(--section-bg);
            border-radius: 0 0 8px 8px;
            margin-top: 0.5rem;
        }

        .recipe-content.active {
            display: block;
        }

        .recipe-title {
            font-family: 'Oswald', sans-serif;
            font-size: 0.9rem;
            color: var(--accent-orange);
            margin-bottom: 0.75rem;
        }

        .recipe-section-title {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 0.5rem;
            margin-top: 0.75rem;
        }

        .recipe-section-title:first-child {
            margin-top: 0;
        }

        .ingredients-list {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .ingredients-list li {
            font-size: 0.8rem;
            color: var(--text-secondary);
            padding: 0.25rem 0;
            padding-left: 1rem;
            position: relative;
        }

        .ingredients-list li::before {
            content: "•";
            position: absolute;
            left: 0;
            color: var(--accent-green);
        }

        .recipe-instructions {
            font-size: 0.8rem;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .alternatives {
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-subtle);
        }

        .alternatives-title {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            margin-bottom: 0.35rem;
        }

        .alternatives-list {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .snacks-section {
            background: var(--section-bg);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .snacks-title {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--accent-yellow);
            margin-bottom: 0.75rem;
            font-weight: 600;
        }

        .snack-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-subtle);
            font-size: 0.85rem;
        }

        .snack-item:last-child {
            border-bottom: none;
            padding-bottom: 0;
        }

        .snack-name {
            color: var(--text-muted);
            font-size: 0.75rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .snack-suggestion {
            color: var(--text-secondary);
        }

        .snack-calories {
            color: var(--text-muted);
            font-size: 0.75rem;
        }

        /* Nutrition section scroll for desktop */
        @media (min-width: 769px) {
            .nutrition-section {
                max-height: 70vh;
                overflow-y: auto;
                padding-right: 0.5rem;
            }
        }

        .nutrition-section::-webkit-scrollbar {
            width: 6px;
        }

        .nutrition-section::-webkit-scrollbar-track {
            background: var(--bg-card);
        }

        .nutrition-section::-webkit-scrollbar-thumb {
            background: var(--border-subtle);
            border-radius: 3px;
        }

        .nutrition-section::-webkit-scrollbar-thumb:hover {
            background: var(--accent-orange);
        }

        /* Golden Rules Section */
        .golden-rules {
            background: linear-gradient(135deg, rgba(212,160,18,0.1) 0%, rgba(232,93,37,0.1) 100%);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 2rem;
            border: 1px solid var(--accent-yellow);
        }

        [data-theme="dark"] .golden-rules {
            background: linear-gradient(135deg, rgba(247,201,72,0.1) 0%, rgba(255,107,53,0.1) 100%);
        }

        .golden-rules h3 {
            font-family: 'Oswald', sans-serif;
            font-size: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--accent-yellow);
            margin-bottom: 1rem;
        }

        .rules-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
        }

        .rule {
            font-size: 0.85rem;
            color: var(--text-secondary);
            display: flex;
            align-items: flex-start;
            gap: 0.5rem;
        }

        .rule-num {
            background: var(--accent-orange);
            color: #000;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.7rem;
            font-weight: 700;
            flex-shrink: 0;
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .rule.clickable {
            cursor: pointer;
            padding: 0.5rem 0.75rem;
            margin: -0.5rem -0.75rem;
            border-radius: 8px;
            transition: all 0.2s ease;
        }

        .rule.clickable:hover {
            background: rgba(232, 93, 37, 0.1);
            color: var(--text-primary);
        }

        .rule.clickable:hover .rule-num {
            transform: scale(1.1);
            box-shadow: 0 2px 8px rgba(232, 93, 37, 0.3);
        }

        .rule.clickable:active {
            transform: scale(0.98);
        }

        .view-rules-btn {
            display: block;
            width: 100%;
            margin-top: 1.25rem;
            padding: 0.85rem 1.5rem;
            background: linear-gradient(135deg, var(--accent-orange), #ff8c5a);
            border: none;
            border-radius: 8px;
            color: white;
            font-family: 'Oswald', sans-serif;
            font-size: 0.9rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .view-rules-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 15px rgba(232, 93, 37, 0.4);
        }

        /* Golden Rules Modal */
        .rules-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: var(--modal-overlay);
            display: none;
            justify-content: center;
            align-items: flex-start;
            padding: 1rem;
            overflow-y: auto;
            z-index: 1000;
            -webkit-overflow-scrolling: touch;
        }

        .rules-modal-overlay.active {
            display: flex;
        }

        .rules-modal {
            background: var(--bg-card);
            border-radius: 16px;
            max-width: 800px;
            width: 100%;
            margin: 1rem auto;
            border: 1px solid var(--border-subtle);
            animation: modalSlide 0.3s ease;
            box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25);
        }

        .rules-modal-header {
            padding: 1.5rem 2rem;
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: linear-gradient(135deg, rgba(247,201,72,0.1) 0%, rgba(232,93,37,0.1) 100%);
            border-radius: 16px 16px 0 0;
        }

        [data-theme="dark"] .rules-modal-header {
            background: linear-gradient(135deg, rgba(247,201,72,0.15) 0%, rgba(255,107,53,0.15) 100%);
        }

        .rules-modal-header h2 {
            font-family: 'Oswald', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            background: linear-gradient(135deg, var(--accent-orange), var(--accent-yellow));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .rules-modal-body {
            padding: 1.5rem 2rem;
            max-height: 70vh;
            overflow-y: auto;
        }

        .rules-modal-body::-webkit-scrollbar {
            width: 6px;
        }

        .rules-modal-body::-webkit-scrollbar-track {
            background: var(--bg-card);
        }

        .rules-modal-body::-webkit-scrollbar-thumb {
            background: var(--border-subtle);
            border-radius: 3px;
        }

        .golden-rule-card {
            background: var(--section-bg);
            border: 1px solid var(--border-subtle);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.25rem;
            transition: all 0.3s ease;
        }

        .golden-rule-card:hover {
            border-color: var(--accent-orange);
        }

        .golden-rule-card:last-child {
            margin-bottom: 0;
        }

        .golden-rule-header {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .golden-rule-number {
            background: linear-gradient(135deg, var(--accent-orange), var(--accent-yellow));
            color: #000;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-family: 'Oswald', sans-serif;
            font-size: 1.1rem;
            font-weight: 700;
            flex-shrink: 0;
        }

        .golden-rule-title {
            font-family: 'Oswald', sans-serif;
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .golden-rule-subtitle {
            font-size: 0.85rem;
            color: var(--accent-orange);
            font-style: italic;
        }

        .golden-rule-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-subtle);
        }

        .golden-rule-section:first-of-type {
            margin-top: 0.5rem;
            padding-top: 0;
            border-top: none;
        }

        .golden-rule-section-title {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--accent-green);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .golden-rule-section-title.why {
            color: var(--accent-purple);
        }

        .golden-rule-section-title.do {
            color: var(--accent-green);
        }

        .golden-rule-section-title.looks {
            color: var(--accent-blue);
        }

        .golden-rule-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .golden-rule-list li {
            font-size: 0.9rem;
            color: var(--text-secondary);
            padding: 0.35rem 0;
            padding-left: 1.25rem;
            position: relative;
        }

        .golden-rule-list li::before {
            content: "•";
            position: absolute;
            left: 0;
            color: var(--accent-orange);
            font-weight: bold;
        }

        .golden-rule-tip {
            background: linear-gradient(135deg, rgba(247,201,72,0.1) 0%, rgba(232,93,37,0.05) 100%);
            border-left: 3px solid var(--accent-yellow);
            padding: 0.75rem 1rem;
            border-radius: 0 8px 8px 0;
            margin-top: 0.75rem;
        }

        .golden-rule-tip p {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin: 0;
        }

        .golden-rule-tip strong {
            color: var(--accent-yellow);
        }

        .meta-rule {
            background: linear-gradient(135deg, rgba(232,93,37,0.15) 0%, rgba(247,201,72,0.15) 100%);
            border: 2px solid var(--accent-orange);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            margin-top: 1.5rem;
        }

        .meta-rule-label {
            font-size: 0.7rem;
            text-transform: uppercase;
            letter-spacing: 0.15em;
            color: var(--accent-orange);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .meta-rule-text {
            font-family: 'Oswald', sans-serif;
            font-size: 1.1rem;
            color: var(--text-primary);
            font-weight: 500;
        }

        @media (max-width: 768px) {
            .rules-modal-header {
                padding: 1rem 1.25rem;
            }

            .rules-modal-header h2 {
                font-size: 1.25rem;
            }

            .rules-modal-body {
                padding: 1rem;
                max-height: 75vh;
            }

            .golden-rule-card {
                padding: 1rem;
            }

            .golden-rule-header {
                gap: 0.75rem;
            }

            .golden-rule-number {
                width: 30px;
                height: 30px;
                font-size: 0.95rem;
            }

            .golden-rule-title {
                font-size: 1rem;
            }

            .golden-rule-subtitle {
                font-size: 0.8rem;
            }

            .golden-rule-list li {
                font-size: 0.85rem;
            }

            .view-rules-btn {
                font-size: 0.8rem;
                padding: 0.75rem 1rem;
            }
        }

        @media (max-width: 480px) {
            .rules-modal {
                margin: 0.5rem;
                border-radius: 12px;
            }

            .rules-modal-header {
                border-radius: 12px 12px 0 0;
            }

            .golden-rule-card {
                padding: 0.85rem;
                border-radius: 8px;
            }

            .golden-rule-title {
                font-size: 0.95rem;
            }

            .golden-rule-tip {
                padding: 0.6rem 0.75rem;
            }

            .meta-rule {
                padding: 1rem;
            }

            .meta-rule-text {
                font-size: 0.95rem;
            }
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 2rem;
            border-top: 1px solid var(--border-subtle);
            color: var(--text-muted);
            font-size: 0.85rem;
        }

        .footer strong {
            color: var(--accent-orange);
        }

        /* PWA Install Banner */
        .install-banner {
            position: fixed;
            bottom: -100px;
            left: 50%;
            transform: translateX(-50%);
            background: var(--bg-card);
            border: 1px solid var(--accent-orange);
            border-radius: 16px;
            padding: 1rem 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            box-shadow: 0 -4px 20px var(--shadow-color);
            z-index: 1001;
            transition: bottom 0.4s ease;
            max-width: 90%;
            width: 500px;
        }

        .install-banner.show {
            bottom: 20px;
        }

        .install-banner-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--accent-orange), #ff8c5a);
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
        }

        .install-banner-icon svg {
            width: 24px;
            height: 24px;
            fill: white;
        }

        .install-banner-content {
            flex: 1;
        }

        .install-banner-title {
            font-family: 'Oswald', sans-serif;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .install-banner-text {
            font-size: 0.8rem;
            color: var(--text-secondary);
        }

        .install-banner-buttons {
            display: flex;
            gap: 0.5rem;
        }

        .install-btn {
            background: var(--accent-orange);
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            font-family: 'Oswald', sans-serif;
            font-size: 0.85rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .install-btn:hover {
            background: #d4521d;
            transform: scale(1.02);
        }

        .dismiss-btn {
            background: transparent;
            color: var(--text-muted);
            border: 1px solid var(--border-subtle);
            padding: 0.6rem 1rem;
            border-radius: 8px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .dismiss-btn:hover {
            border-color: var(--text-secondary);
            color: var(--text-secondary);
        }

        @media (max-width: 540px) {
            .install-banner {
                flex-direction: column;
                text-align: center;
                padding: 1.25rem;
            }
            
            .install-banner-buttons {
                width: 100%;
                justify-content: center;
            }
        }

        /* Offline indicator */
        .offline-indicator {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: #ef4444;
            color: white;
            text-align: center;
            padding: 0.5rem;
            font-size: 0.8rem;
            z-index: 1002;
            display: none;
        }

        .offline-indicator.show {
            display: block;
        }

        /* Monthly Calendar Styles */
        .calendar-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .calendar-nav {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .calendar-nav-btn {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            color: var(--text-primary);
            font-family: 'Oswald', sans-serif;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .calendar-nav-btn:hover {
            border-color: var(--accent-orange);
            color: var(--accent-orange);
        }

        .calendar-month-title {
            font-family: 'Oswald', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            min-width: 200px;
            text-align: center;
        }

        .calendar-actions {
            display: flex;
            gap: 0.5rem;
            align-items: center;
        }

        .today-btn {
            background: var(--accent-orange);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0.5rem 1rem;
            cursor: pointer;
            font-family: 'Oswald', sans-serif;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            transition: all 0.3s ease;
        }

        .today-btn:hover {
            background: #d4521d;
            transform: translateY(-1px);
        }

        .week-indicator {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1rem;
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        .week-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-family: 'Oswald', sans-serif;
            font-size: 0.8rem;
            font-weight: 600;
            text-transform: uppercase;
        }

        .week-badge.week-1 { background: var(--accent-orange); color: #000; }
        .week-badge.week-2 { background: var(--accent-green); color: #000; }
        .week-badge.week-3 { background: var(--accent-blue); color: #fff; }
        .week-badge.week-4 { background: var(--accent-purple); color: #fff; }

        .week-theme {
            font-size: 0.9rem;
            color: var(--text-secondary);
        }

        .month-calendar {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .calendar-day-header {
            text-align: center;
            padding: 0.75rem 0.5rem;
            font-family: 'Oswald', sans-serif;
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 0.1em;
            color: var(--text-muted);
            border-bottom: 1px solid var(--border-subtle);
        }

        .calendar-cell {
            background: var(--bg-card);
            border: 1px solid var(--border-subtle);
            border-radius: 8px;
            padding: 0.5rem;
            min-height: 100px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .calendar-cell:hover {
            border-color: var(--accent-orange);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        .calendar-cell.empty {
            background: transparent;
            border: 1px dashed var(--border-subtle);
            cursor: default;
        }

        .calendar-cell.empty:hover {
            transform: none;
            box-shadow: none;
            border-color: var(--border-subtle);
        }

        .calendar-cell.today {
            border: 2px solid var(--accent-orange);
            box-shadow: 0 0 0 3px rgba(232, 93, 37, 0.2);
        }

        .calendar-date {
            font-family: 'Oswald', sans-serif;
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.25rem;
        }

        .calendar-cell.today .calendar-date {
            color: var(--accent-orange);
        }

        .calendar-week-badge {
            position: absolute;
            top: 0.35rem;
            right: 0.35rem;
            font-size: 0.6rem;
            padding: 0.15rem 0.35rem;
            border-radius: 3px;
            font-weight: 600;
        }

        .calendar-workout-type {
            font-size: 0.6rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            padding: 0.15rem 0.4rem;
            border-radius: 3px;
            display: inline-block;
            margin-bottom: 0.25rem;
        }

        .calendar-workout-type.gym { background: var(--accent-orange); color: #000; }
        .calendar-workout-type.cardio { background: var(--accent-green); color: #000; }
        .calendar-workout-type.recovery { background: var(--accent-purple); color: #fff; }

        .calendar-workout-title {
            font-size: 0.7rem;
            color: var(--text-secondary);
            line-height: 1.3;
            overflow: hidden;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
        }

        @media (max-width: 900px) {
            .calendar-header {
                flex-direction: column;
                align-items: stretch;
            }

            .calendar-nav {
                justify-content: center;
            }

            .calendar-actions {
                justify-content: center;
            }

            .calendar-cell {
                min-height: 80px;
                padding: 0.35rem;
            }

            .calendar-date {
                font-size: 0.95rem;
            }

            .calendar-workout-title {
                font-size: 0.65rem;
            }
        }

        @media (max-width: 600px) {
            .month-calendar {
                gap: 0.25rem;
            }

            .calendar-day-header {
                font-size: 0.65rem;
                padding: 0.5rem 0.25rem;
            }

            .calendar-cell {
                min-height: 70px;
                padding: 0.25rem;
                border-radius: 6px;
            }

            .calendar-date {
                font-size: 0.85rem;
            }

            .calendar-week-badge {
                display: none;
            }

            .calendar-workout-type {
                font-size: 0.5rem;
                padding: 0.1rem 0.25rem;
            }

            .calendar-workout-title {
                font-size: 0.55rem;
                -webkit-line-clamp: 1;
            }

            .week-indicator {
                flex-direction: column;
                text-align: center;
                gap: 0.5rem;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="theme-toggle-wrapper">
            <button class="theme-toggle" onclick="toggleTheme()" title="Toggle theme">
                <svg class="sun-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <circle cx="12" cy="12" r="5"/>
                    <path d="M12 1v2M12 21v2M4.22 4.22l1.42 1.42M18.36 18.36l1.42 1.42M1 12h2M21 12h2M4.22 19.78l1.42-1.42M18.36 5.64l1.42-1.42"/>
                </svg>
                <svg class="moon-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                </svg>
            </button>
        </div>
        <h1>12-Month Fat Loss Program</h1>
        <p>Weekly Training & Nutrition Calendar</p>
        <div class="stats-bar">
            <div class="stat">
                <div class="stat-value">110 → 91kg</div>
                <div class="stat-label">Target Weight</div>
            </div>
            <div class="stat">
                <div class="stat-value">~0.4 kg/week</div>
                <div class="stat-label">Loss Rate</div>
            </div>
            <div class="stat">
                <div class="stat-value">2,400-2,700</div>
                <div class="stat-label">Daily Calories</div>
            </div>
            <div class="stat">
                <div class="stat-value">150-170g</div>
                <div class="stat-label">Daily Protein</div>
            </div>
        </div>
    </header>

    <main class="calendar-container">
        <div class="calendar-header">
            <div class="calendar-nav">
                <button class="calendar-nav-btn" onclick="previousMonth()">&lt; Prev</button>
                <div class="calendar-month-title" id="month-title">February 2026</div>
                <button class="calendar-nav-btn" onclick="nextMonth()">Next &gt;</button>
            </div>
            <div class="calendar-actions">
                <button class="today-btn" onclick="goToToday()">Today</button>
            </div>
        </div>
        <div class="week-indicator" id="week-indicator">
            <span class="week-badge week-1" id="current-week-badge">W1</span>
            <span class="week-theme" id="current-week-theme">Foundation Week</span>
        </div>
        <div class="month-calendar" id="calendar"></div>

        <div class="golden-rules">
            <h3>⚡ The Golden Rules</h3>
            <div class="rules-grid">
                <div class="rule clickable" onclick="openGoldenRulesModal(1)"><span class="rule-num">1</span> Protein first, always</div>
                <div class="rule clickable" onclick="openGoldenRulesModal(2)"><span class="rule-num">2</span> Never compensate food with exercise</div>
                <div class="rule clickable" onclick="openGoldenRulesModal(3)"><span class="rule-num">3</span> Bad sleep = no deficit</div>
                <div class="rule clickable" onclick="openGoldenRulesModal(4)"><span class="rule-num">4</span> Weekly averages > daily perfection</div>
                <div class="rule clickable" onclick="openGoldenRulesModal(5)"><span class="rule-num">5</span> Miss nothing twice</div>
            </div>
            <button class="view-rules-btn" onclick="openGoldenRulesModal()">
                📖 View Full Golden Rules Guide
            </button>
        </div>
    </main>

    <div class="modal-overlay" id="modal">
        <div class="modal">
            <div class="modal-header">
                <div>
                    <h2 id="modal-title">Monday</h2>
                </div>
                <button class="close-btn" onclick="closeModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="modal-body" id="modal-body">
                <!-- Content injected by JS -->
            </div>
        </div>
    </div>

    <footer class="footer">
        <p>Target pace: <strong>~0.4 kg/week</strong> • Total focused exercise time: <strong>~4-5 hours/week</strong></p>
        <p style="margin-top: 0.5rem;">Consistency > Perfection • Energy, sleep, and stress improve before big scale changes</p>
    </footer>

    <!-- Offline Indicator -->
    <div class="offline-indicator" id="offline-indicator">
        📴 You're offline. Some features may be limited.
    </div>

    <!-- PWA Install Banner -->
    <div class="install-banner" id="install-banner">
        <div class="install-banner-icon">
            <svg viewBox="0 0 24 24"><path d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z"/></svg>
        </div>
        <div class="install-banner-content">
            <div class="install-banner-title">Install Fat Loss Plan</div>
            <div class="install-banner-text">Add to home screen for quick access & offline use</div>
        </div>
        <div class="install-banner-buttons">
            <button class="install-btn" id="install-btn">Install</button>
            <button class="dismiss-btn" id="dismiss-btn">Not now</button>
        </div>
    </div>

    <!-- Golden Rules Modal -->
    <div class="rules-modal-overlay" id="rules-modal">
        <div class="rules-modal">
            <div class="rules-modal-header">
                <h2>🥇 The Golden Rules</h2>
                <button class="close-btn" onclick="closeGoldenRulesModal()">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M18 6L6 18M6 6l12 12"/>
                    </svg>
                </button>
            </div>
            <div class="rules-modal-body" id="rules-modal-body">
                <!-- Rule 1 -->
                <div class="golden-rule-card" id="golden-rule-1">
                    <div class="golden-rule-header">
                        <span class="golden-rule-number">1</span>
                        <div>
                            <div class="golden-rule-title">Protein First, Always</div>
                            <div class="golden-rule-subtitle">This is the keystone habit. Break this and everything else wobbles.</div>
                        </div>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title why">Why It Matters</div>
                        <ul class="golden-rule-list">
                            <li>Controls hunger better than any macro</li>
                            <li>Preserves muscle while you lose weight</li>
                            <li>Improves recovery and sleep quality</li>
                            <li>Makes "accidental overeating" much harder</li>
                        </ul>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title do">What To Do</div>
                        <ul class="golden-rule-list">
                            <li>Every meal starts by asking: <strong>"Where is the protein?"</strong></li>
                            <li>Aim for 30–45g per main meal</li>
                            <li>If in doubt, add protein instead of removing food</li>
                        </ul>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title looks">What It Looks Like</div>
                        <ul class="golden-rule-list">
                            <li>Breakfast rushed? → Protein shake <em>plus</em> whatever else</li>
                            <li>Takeout dinner? → Double chicken, skip extra sauces</li>
                            <li>Late-night hunger? → Greek yogurt, not cereal</li>
                        </ul>
                    </div>
                    <div class="golden-rule-tip">
                        <p><strong>Rule of thumb:</strong> If protein is hit, calories usually fall into place.</p>
                    </div>
                </div>

                <!-- Rule 2 -->
                <div class="golden-rule-card" id="golden-rule-2">
                    <div class="golden-rule-header">
                        <span class="golden-rule-number">2</span>
                        <div>
                            <div class="golden-rule-title">Never Compensate Food With Exercise</div>
                            <div class="golden-rule-subtitle">Exercise is for fitness and metabolism—not permission to eat.</div>
                        </div>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title why">Why It Matters</div>
                        <ul class="golden-rule-list">
                            <li>Exercise calorie estimates are wildly inaccurate</li>
                            <li>"I earned this" leads to chronic overeating</li>
                            <li>Compensation kills consistency</li>
                        </ul>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title do">What To Do</div>
                        <ul class="golden-rule-list">
                            <li>Eat the same way on training days</li>
                            <li>Let weight trends—not single workouts—drive adjustments</li>
                            <li>Fuel workouts with carbs because they help performance, not as rewards</li>
                        </ul>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title looks">What It Looks Like</div>
                        <ul class="golden-rule-list">
                            <li>Big leg day? → Normal structured meals</li>
                            <li>Long bike ride? → Add carbs <em>around the ride</em>, not a giant dessert</li>
                            <li>Missed workout? → Don't punish food intake</li>
                        </ul>
                    </div>
                    <div class="golden-rule-tip">
                        <p><strong>Mindset shift:</strong> You train because you eat—not the other way around.</p>
                    </div>
                </div>

                <!-- Rule 3 -->
                <div class="golden-rule-card" id="golden-rule-3">
                    <div class="golden-rule-header">
                        <span class="golden-rule-number">3</span>
                        <div>
                            <div class="golden-rule-title">Bad Sleep = No Deficit</div>
                            <div class="golden-rule-subtitle">This one protects your hormones and sanity.</div>
                        </div>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title why">Why It Matters</div>
                        <ul class="golden-rule-list">
                            <li>Poor sleep raises hunger hormones</li>
                            <li>Cortisol encourages fat storage</li>
                            <li>Recovery + injury risk worsen when under-fueled</li>
                        </ul>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title do">What To Do (If Sleep &lt;6 Hours)</div>
                        <ul class="golden-rule-list">
                            <li>Eat at <strong>maintenance</strong></li>
                            <li>Keep protein high</li>
                            <li>Reduce training intensity (Zone 2 > HIIT)</li>
                        </ul>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title looks">What It Looks Like</div>
                        <ul class="golden-rule-list">
                            <li>Rough night with kids → Normal breakfast + extra carbs at lunch</li>
                            <li>Exhausted day → Skip plyos, do mobility + walk</li>
                            <li>No "making up" for bad sleep later</li>
                        </ul>
                    </div>
                    <div class="golden-rule-tip">
                        <p><strong>Hidden benefit:</strong> This prevents binge–restrict cycles.</p>
                    </div>
                </div>

                <!-- Rule 4 -->
                <div class="golden-rule-card" id="golden-rule-4">
                    <div class="golden-rule-header">
                        <span class="golden-rule-number">4</span>
                        <div>
                            <div class="golden-rule-title">Weekly Averages Beat Daily Perfection</div>
                            <div class="golden-rule-subtitle">Fat loss happens in trends, not moments.</div>
                        </div>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title why">Why It Matters</div>
                        <ul class="golden-rule-list">
                            <li>Water, sodium, stress, and training mask fat loss</li>
                            <li>Daily weight is noisy</li>
                            <li>Perfectionism causes quit cycles</li>
                        </ul>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title do">What To Do</div>
                        <ul class="golden-rule-list">
                            <li>Track weight daily <strong>without reacting</strong></li>
                            <li>Look only at <strong>7-day averages</strong></li>
                            <li>Adjust food every <strong>2 weeks</strong>, not daily</li>
                        </ul>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title looks">What It Looks Like</div>
                        <ul class="golden-rule-list">
                            <li>Scale up 1 kg after salty meal → ignore</li>
                            <li>Flat week after hard training → ignore</li>
                            <li>Flat 3 weeks → small adjustment</li>
                        </ul>
                    </div>
                    <div class="golden-rule-tip">
                        <p><strong>Rule:</strong> If you're thinking about calories every day, zoom out.</p>
                    </div>
                </div>

                <!-- Rule 5 -->
                <div class="golden-rule-card" id="golden-rule-5">
                    <div class="golden-rule-header">
                        <span class="golden-rule-number">5</span>
                        <div>
                            <div class="golden-rule-title">Miss Nothing Twice</div>
                            <div class="golden-rule-subtitle">Consistency is a behavior, not a streak.</div>
                        </div>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title why">Why It Matters</div>
                        <ul class="golden-rule-list">
                            <li>One miss is life</li>
                            <li>Two misses is a pattern</li>
                            <li>Guilt spirals kill long-term progress</li>
                        </ul>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title do">What To Do (If You Miss)</div>
                        <ul class="golden-rule-list">
                            <li>Resume at the <strong>next planned session</strong></li>
                            <li>No doubling workouts</li>
                            <li>No food punishment</li>
                        </ul>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title looks">What It Looks Like</div>
                        <ul class="golden-rule-list">
                            <li>Miss Monday workout → Train Tuesday as planned</li>
                            <li>Overeat at dinner → Normal breakfast next day</li>
                            <li>Bad weekend → Clean slate Monday</li>
                        </ul>
                    </div>
                    <div class="golden-rule-tip">
                        <p><strong>Identity shift:</strong> You're someone who <em>returns quickly</em>.</p>
                    </div>
                </div>

                <!-- Rule 6 -->
                <div class="golden-rule-card" id="golden-rule-6">
                    <div class="golden-rule-header">
                        <span class="golden-rule-number">6</span>
                        <div>
                            <div class="golden-rule-title">Reduce Friction Before Adding Discipline</div>
                            <div class="golden-rule-subtitle">Make the right choice the easy choice.</div>
                        </div>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title why">Why It Matters</div>
                        <ul class="golden-rule-list">
                            <li>Willpower is limited</li>
                            <li>Busy parents need automation</li>
                            <li>Environment beats motivation</li>
                        </ul>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title do">What To Do</div>
                        <ul class="golden-rule-list">
                            <li>Prepare the night before</li>
                            <li>Keep default meals</li>
                            <li>Store trigger foods out of sight</li>
                        </ul>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title looks">What It Looks Like</div>
                        <ul class="golden-rule-list">
                            <li>Gym bag packed at night</li>
                            <li>Same breakfast Mon–Fri</li>
                            <li>Protein visible, snacks hidden</li>
                        </ul>
                    </div>
                    <div class="golden-rule-tip">
                        <p><strong>Golden insight:</strong> If it requires motivation, it's too complex.</p>
                    </div>
                </div>

                <!-- Rule 7 -->
                <div class="golden-rule-card" id="golden-rule-7">
                    <div class="golden-rule-header">
                        <span class="golden-rule-number">7</span>
                        <div>
                            <div class="golden-rule-title">Train to Recover, Not to Destroy</div>
                            <div class="golden-rule-subtitle">You're not 22—and that's a strength.</div>
                        </div>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title why">Why It Matters</div>
                        <ul class="golden-rule-list">
                            <li>Recovery capacity governs fat loss</li>
                            <li>Overreaching = stalled progress</li>
                            <li>Quality beats volume</li>
                        </ul>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title do">What To Do</div>
                        <ul class="golden-rule-list">
                            <li>Leave <strong>1–2 reps in reserve</strong></li>
                            <li>Keep plyometrics crisp, low-volume</li>
                            <li>Deload every 4th week</li>
                        </ul>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title looks">What It Looks Like</div>
                        <ul class="golden-rule-list">
                            <li>Feeling great? → Progress slowly</li>
                            <li>Feeling beat up? → Reduce volume, not frequency</li>
                            <li>Joint pain? → Swap jumps for swings or sleds</li>
                        </ul>
                    </div>
                    <div class="golden-rule-tip">
                        <p><strong>Rule:</strong> You should leave the gym feeling <em>better</em> than you arrived.</p>
                    </div>
                </div>

                <!-- Rule 8 -->
                <div class="golden-rule-card" id="golden-rule-8">
                    <div class="golden-rule-header">
                        <span class="golden-rule-number">8</span>
                        <div>
                            <div class="golden-rule-title">Protect Sleep Like It's Part of Training</div>
                            <div class="golden-rule-subtitle">Because it is.</div>
                        </div>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title why">Why It Matters</div>
                        <ul class="golden-rule-list">
                            <li>Sleep drives fat loss hormones</li>
                            <li>Poor sleep increases injury risk</li>
                            <li>Sleep improves decision-making</li>
                        </ul>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title do">What To Do</div>
                        <ul class="golden-rule-list">
                            <li>Fixed wake time</li>
                            <li>Protein + carbs at dinner</li>
                            <li>Screens off 30 min before bed</li>
                        </ul>
                    </div>
                    <div class="golden-rule-section">
                        <div class="golden-rule-section-title looks">What It Looks Like</div>
                        <ul class="golden-rule-list">
                            <li>Late training → lighter dinner, earlier wind-down</li>
                            <li>Insomnia night → next day Zone 2 only</li>
                            <li>Short sleep streak → eat more, not less</li>
                        </ul>
                    </div>
                </div>

                <!-- Meta Rule -->
                <div class="meta-rule">
                    <div class="meta-rule-label">🧠 The Meta-Golden Rule</div>
                    <div class="meta-rule-text">"When in doubt, choose the option you can repeat for 12 months."</div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Theme toggle
        function toggleTheme() {
            const html = document.documentElement;
            const currentTheme = html.getAttribute('data-theme');
            const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
            html.setAttribute('data-theme', newTheme);
            localStorage.setItem('theme', newTheme);
        }

        // Load saved theme
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme') || 'light';
            if (savedTheme === 'dark') {
                document.documentElement.setAttribute('data-theme', 'dark');
            }
        }

        loadTheme();

        const PROGRAM_START_DATE = new Date(2026, 1, 2);
        let currentYear = 2026;
        let currentMonth = 1;

        const weekThemes = [
            { name: "Foundation", theme: "foundation" },
            { name: "Strength Focus", theme: "strength" },
            { name: "Athletic Development", theme: "athletic" },
            { name: "Integration", theme: "integration" }
        ];

        const monthlyProgram = {
            weeks: [
                {
                    name: "Foundation",
                    theme: "foundation",
                    days: [
                        {
                            day: "Monday",
                            type: "gym",
                            typeLabel: "Gym Day",
                            title: "Lower Body Power + Foot Work",
                            duration: "65 min",
                            dietType: "Training Day",
                            workout: {
                                warmup: { title: "Warm-up (10 min)", exercises: [["Dynamic hips & ankles", ""], ["Light rowing", "3-5 min"]] },
                                main: { title: "Strength + Plyo (25 min)", exercises: [["Goblet Squats (KB)", "4×8"], ["Box Jumps / Step Jumps", "4×5"], ["Romanian Deadlift (KB)", "3×10"], ["Walking Lunges", "3×12/leg"]] },
                                conditioning: { title: "Conditioning (15 min)", exercises: [["Rowing Machine Intervals", ""], ["250m hard / 250m easy", "×6 rounds"]] },
                                footwork: { title: "Foot Strengthening (5 min)", exercises: [["Toe curls with towel", "3×15"], ["Arch lifts", "3×12"], ["Single-leg balance", "30s each"]] },
                                cooldown: { title: "Cooldown (10 min)", exercises: [["Hip flexor stretch", ""], ["Hamstring stretch", ""], ["Calf stretch", ""]] }
                            },
                            tips: ["Eat carbs earlier and post-training", "Focus on explosive movement in plyos", "Keep rowing at ~75-80% effort on hard portions"]
                        },
                        {
                            day: "Tuesday",
                            type: "gym",
                            typeLabel: "Gym Day",
                            title: "Upper Body Calisthenics + HIIT",
                            duration: "60 min",
                            dietType: "Training Day",
                            workout: {
                                warmup: { title: "Warm-up (8 min)", exercises: [["Resistance bands", "shoulder activation"], ["Shoulder mobility drills", ""]] },
                                main: { title: "Calisthenics Strength (30 min)", exercises: [["Pull-ups (or assisted)", "4×AMRAP"], ["Push-ups", "4×15"], ["Dips (or bench dips)", "3×10"], ["Hanging Knee Raises", "3×12"]] },
                                hiit: { title: "HIIT Finisher (12 min)", exercises: [["Kettlebell Swings", "20 sec on / 40 sec off"], ["Repeat", "×10 rounds"]] },
                                cooldown: { title: "Stretch (10 min)", exercises: [["Chest stretch", ""], ["Shoulder stretch", ""], ["Lat stretch", ""]] }
                            },
                            tips: ["AMRAP = As Many Reps As Possible with good form", "KB swings should be hip-driven", "Use bands or negatives if pull-ups are hard"]
                        },
                        {
                            day: "Wednesday",
                            type: "cardio",
                            typeLabel: "Cardio",
                            title: "Step Machine + Hip Mobility",
                            duration: "55 min",
                            dietType: "Active Day",
                            workout: {
                                main: { title: "Step Machine (30 min)", exercises: [["Stair climber steady state", "20 min Zone 2"], ["Interval steps: 1 min fast / 1 min slow", "5 rounds"], ["Cool-down pace", "5 min"]] },
                                hip: { title: "Hip Mobility (15 min)", exercises: [["Hip 90/90 stretch", "2×60s each side"], ["Pigeon stretch", "2×60s each side"], ["Hip circles", "2×10 each direction"]] },
                                cooldown: { title: "Stretch (10 min)", exercises: [["Quad stretch", "60s each"], ["Calf stretch", "60s each"], ["Diaphragmatic breathing", "2 min"]] }
                            },
                            tips: ["Keep upright posture on the step machine", "Don't grip the rails—light touch only", "Hip mobility after steps keeps you loose"]
                        },
                        {
                            day: "Thursday",
                            type: "gym",
                            typeLabel: "Gym Day",
                            title: "Full-Body Kettlebell Power",
                            duration: "60 min",
                            dietType: "Training Day",
                            workout: {
                                warmup: { title: "Warm-up (10 min)", exercises: [["Light KB swings", ""], ["KB halos", ""], ["Hip circles", ""]] },
                                main: { title: "KB Complex (30 min) — 4-5 rounds", exercises: [["KB Clean", "×5/side"], ["KB Press", "×5/side"], ["KB Front Squat", "×6"], ["KB Snatch", "×5/side"], ["Rest between rounds", "2 min"]] },
                                cooldown: { title: "Core + Stretch (20 min)", exercises: [["Planks", "3×30-45 sec"], ["Dead bugs", "3×10/side"], ["Hip mobility", ""], ["Shoulder mobility", ""]] }
                            },
                            tips: ["Minimal rest BETWEEN movements, full rest between rounds", "Focus on hip hinge mechanics", "Start lighter—KB complexes are demanding"]
                        },
                        {
                            day: "Friday",
                            type: "gym",
                            typeLabel: "Gym Day",
                            title: "Plyometrics + Run/Row",
                            duration: "60 min",
                            dietType: "Training Day",
                            workout: {
                                warmup: { title: "Warm-up (10 min)", exercises: [["Dynamic stretching", ""], ["Light jogging/rowing", ""], ["Activation drills", ""]] },
                                plyo: { title: "Plyo Circuit (20 min)", exercises: [["Jump Squats", "3×8"], ["Plyo Push-ups", "3×6"], ["Lateral Bounds", "3×8/side"]] },
                                cardio: { title: "Cardio (20 min)", exercises: [["Treadmill intervals OR Rower sprints", ""], ["30 sec hard / 90 sec easy", "×8-10 rounds"]] },
                                cooldown: { title: "Stretch (10 min)", exercises: [["Full body stretching", ""], ["Focus on legs and hips", ""]] }
                            },
                            tips: ["Speed matters more than height in plyos", "Last heavy day of the week—push hard", "If jumping hurts joints, use low-impact versions"]
                        },
                        {
                            day: "Saturday",
                            type: "cardio",
                            typeLabel: "Cardio",
                            title: "Cycling + Foot Strengthening",
                            duration: "45 min",
                            dietType: "Active Day",
                            workout: {
                                main: { title: "Steady State Cycling (30-45 min)", exercises: [["Zone 2 conversational pace", ""], ["Heart rate 60-70% max", ""], ["Optional short hills", ""]] },
                                footwork: { title: "Foot Strengthening (10 min)", exercises: [["Toe curls with towel", "3×15"], ["Arch lifts", "3×12"], ["Calf raises (slow)", "3×15"], ["Single-leg balance", "60s each"]] }
                            },
                            tips: ["Cycling is low-impact recovery while burning calories", "Enjoy time outdoors—mental recovery matters", "ONE indulgence meal max on weekends"]
                        },
                        {
                            day: "Sunday",
                            type: "recovery",
                            typeLabel: "Recovery",
                            title: "Mobility + Light Core",
                            duration: "30 min",
                            dietType: "Recovery Day",
                            workout: {
                                main: { title: "Active Recovery (30 min)", exercises: [["Full-body stretching", ""], ["Yoga-style flow", ""], ["Easy core work", ""], ["Planks, bird dogs", "light"]] }
                            },
                            tips: ["Prepare mentally for the week ahead", "Light movement helps recovery", "Good sleep tonight sets up Monday"]
                        }
                    ]
                },
                {
                    name: "Strength Focus",
                    theme: "strength",
                    days: [
                        {
                            day: "Monday",
                            type: "gym",
                            typeLabel: "Gym Day",
                            title: "Barbell Squats + Accessory",
                            duration: "65 min",
                            dietType: "Training Day",
                            workout: {
                                warmup: { title: "Warm-up (10 min)", exercises: [["Foam rolling quads/glutes", ""], ["Goblet squats", "2×10"], ["Hip circles", ""]] },
                                main: { title: "Barbell Work (35 min)", exercises: [["Back Squat", "5×5 (progressive load)"], ["Pause Squats", "3×6"], ["Bulgarian Split Squats", "3×8/leg"], ["Leg Press", "3×12"]] },
                                accessory: { title: "Accessory (10 min)", exercises: [["Leg Extensions", "3×12"], ["Seated Calf Raises", "3×15"]] },
                                cooldown: { title: "Stretch (10 min)", exercises: [["Quad stretch", ""], ["Hip flexor stretch", ""], ["Hamstring stretch", ""]] }
                            },
                            tips: ["Focus on depth and form over weight", "Progressive overload—add 2.5kg when 5×5 feels comfortable", "Brace core throughout squats"]
                        },
                        {
                            day: "Tuesday",
                            type: "gym",
                            typeLabel: "Gym Day",
                            title: "Upper Body + Hip Flexor Strength",
                            duration: "60 min",
                            dietType: "Training Day",
                            workout: {
                                warmup: { title: "Warm-up (8 min)", exercises: [["Band pull-aparts", ""], ["Shoulder circles", ""], ["Light push-ups", ""]] },
                                main: { title: "Upper Body (30 min)", exercises: [["Bench Press or DB Press", "4×8"], ["Bent Over Rows", "4×10"], ["Overhead Press", "3×8"], ["Face Pulls", "3×15"]] },
                                hipflexor: { title: "Hip Flexor Strength (12 min)", exercises: [["Banded Marches", "3×15/leg"], ["Hanging Knee Raises", "3×12"], ["Psoas Holds (lying)", "3×20s/leg"]] },
                                cooldown: { title: "Stretch (10 min)", exercises: [["Chest stretch", ""], ["Lat stretch", ""], ["Hip flexor stretch", ""]] }
                            },
                            tips: ["Control the negative on all lifts", "Hip flexors are often weak—start light", "Keep shoulders back during rows"]
                        },
                        {
                            day: "Wednesday",
                            type: "cardio",
                            typeLabel: "Cardio",
                            title: "Step Machine + Foot Strengthening",
                            duration: "55 min",
                            dietType: "Active Day",
                            workout: {
                                main: { title: "Step Machine (30 min)", exercises: [["Stair climber steady climb", "15 min Zone 2"], ["Increase resistance/speed", "10 min Zone 2-3"], ["Cool-down pace", "5 min"]] },
                                footwork: { title: "Foot Strengthening (15 min)", exercises: [["Toe curls with towel", "3×15"], ["Arch lifts", "3×12"], ["Calf raises", "3×15"], ["Single-leg balance", "60s each"], ["Toe spreads", "3×10"]] },
                                stretch: { title: "Stretch (10 min)", exercises: [["Quad stretch", "60s each"], ["Calf stretch", "60s each"], ["Ankle circles", "2 min"]] }
                            },
                            tips: ["Step machine builds leg endurance without heavy load", "Keep heart rate in Zone 2-3", "Don't grip the rails—light touch only"]
                        },
                        {
                            day: "Thursday",
                            type: "gym",
                            typeLabel: "Gym Day",
                            title: "Barbell Deadlifts + Hamstrings",
                            duration: "65 min",
                            dietType: "Training Day",
                            workout: {
                                warmup: { title: "Warm-up (10 min)", exercises: [["Cat-cow stretches", ""], ["Hip hinges with band", ""], ["Light RDLs", ""]] },
                                main: { title: "Deadlift Work (35 min)", exercises: [["Conventional Deadlift", "5×5 (progressive)"], ["Romanian Deadlift", "3×10"], ["Good Mornings", "3×12"]] },
                                hamstring: { title: "Hamstring Focus (10 min)", exercises: [["Nordic Curl Negatives", "3×5 (slow)"], ["Lying Leg Curls", "3×12"]] },
                                cooldown: { title: "Stretch (10 min)", exercises: [["Hamstring stretch", ""], ["Glute stretch", ""], ["Lower back stretch", ""]] }
                            },
                            tips: ["Maintain neutral spine throughout", "Start Nordic negatives with assistance", "Hip hinge, don't squat the deadlift"]
                        },
                        {
                            day: "Friday",
                            type: "gym",
                            typeLabel: "Gym Day",
                            title: "Nordic Curls + Plyometrics",
                            duration: "55 min",
                            dietType: "Training Day",
                            workout: {
                                warmup: { title: "Warm-up (10 min)", exercises: [["Light jogging", ""], ["Dynamic leg swings", ""], ["Bodyweight squats", ""]] },
                                main: { title: "Posterior Chain (25 min)", exercises: [["Nordic Curl Progressions", "4×5"], ["Reverse Nordics", "3×8"], ["Hip Thrusts", "3×12"]] },
                                plyo: { title: "Plyometrics (15 min)", exercises: [["Box Jumps", "4×5"], ["Broad Jumps", "3×5"], ["Depth Drops", "3×3"]] },
                                cooldown: { title: "Stretch (5 min)", exercises: [["Quad stretch", ""], ["Hip flexor stretch", ""]] }
                            },
                            tips: ["Nordic curls are HARD—use assistance as needed", "Quality over quantity on plyos", "Full recovery between plyo sets"]
                        },
                        {
                            day: "Saturday",
                            type: "cardio",
                            typeLabel: "Cardio",
                            title: "Cycling + Foot Strengthening",
                            duration: "50 min",
                            dietType: "Active Day",
                            workout: {
                                main: { title: "Cycling (35-40 min)", exercises: [["Zone 2 steady ride", "30 min"], ["Optional moderate hill efforts", "5-10 min"], ["Easy spin cool-down", "5 min"]] },
                                footwork: { title: "Foot Strengthening (10 min)", exercises: [["Toe curls", "3×15"], ["Arch lifts", "3×12"], ["Calf raises", "3×15"], ["Balance work", "2 min"]] }
                            },
                            tips: ["Cycling after strength week flushes the legs", "Keep it Zone 2—this is active recovery", "Enjoy being outdoors"]
                        },
                        {
                            day: "Sunday",
                            type: "recovery",
                            typeLabel: "Recovery",
                            title: "Hip Mobility Deep Stretch",
                            duration: "40 min",
                            dietType: "Recovery Day",
                            workout: {
                                main: { title: "Deep Hip Work (40 min)", exercises: [["Hip 90/90 transitions", "5 min"], ["Pigeon pose", "3×90s each"], ["Frog stretch", "3×60s"], ["Couch stretch", "2×90s each"], ["Happy baby", "2 min"], ["Lying spinal twist", "2 min each"]] }
                            },
                            tips: ["This prepares you for next week's squats/deads", "Breathe deeply into each stretch", "Use props (blocks/pillows) as needed"]
                        }
                    ]
                },
                {
                    name: "Athletic Development",
                    theme: "athletic",
                    days: [
                        {
                            day: "Monday",
                            type: "gym",
                            typeLabel: "Gym Day",
                            title: "Olympic Lift Intro (Clean Pulls)",
                            duration: "65 min",
                            dietType: "Training Day",
                            workout: {
                                warmup: { title: "Warm-up (15 min)", exercises: [["Jump rope", "3 min"], ["Hip hinges", ""], ["High pulls with empty bar", "3×5"]] },
                                main: { title: "Olympic Basics (30 min)", exercises: [["Clean Pulls", "5×3 (light-moderate)"], ["Hang Power Cleans", "4×3"], ["Front Squats", "4×6"]] },
                                accessory: { title: "Accessory (10 min)", exercises: [["RDLs", "3×8"], ["Shrugs", "3×12"]] },
                                cooldown: { title: "Stretch (10 min)", exercises: [["Full body stretch", ""], ["Wrist mobility", ""]] }
                            },
                            tips: ["Olympic lifts are about SPEED, not weight", "Master the pull before adding weight", "Keep bar close to body throughout"]
                        },
                        {
                            day: "Tuesday",
                            type: "gym",
                            typeLabel: "Gym Day",
                            title: "Upper Body Calisthenics",
                            duration: "55 min",
                            dietType: "Training Day",
                            workout: {
                                warmup: { title: "Warm-up (8 min)", exercises: [["Arm circles", ""], ["Band work", ""], ["Light push-ups", ""]] },
                                main: { title: "Calisthenics (35 min)", exercises: [["Pull-ups", "5×max"], ["Dips", "4×max"], ["Push-up variations", "4×12"], ["Inverted Rows", "3×12"], ["L-Sit holds", "5×max hold"]] },
                                cooldown: { title: "Stretch (12 min)", exercises: [["Chest stretch", ""], ["Lat stretch", ""], ["Shoulder stretch", ""]] }
                            },
                            tips: ["Focus on control and full range", "Progress to harder variations when ready", "L-sits build incredible core strength"]
                        },
                        {
                            day: "Wednesday",
                            type: "cardio",
                            typeLabel: "Cardio",
                            title: "Step Machine + Hip Flexibility",
                            duration: "55 min",
                            dietType: "Active Day",
                            workout: {
                                main: { title: "Step Machine (30 min)", exercises: [["Stair climber warm-up", "5 min easy"], ["Steady climb Zone 2", "15 min"], ["Sprint intervals: 30s fast / 60s moderate", "5 rounds"], ["Cool-down", "5 min"]] },
                                hip: { title: "Hip Flexibility (15 min)", exercises: [["Hip 90/90", "2×60s each"], ["Pigeon", "2×60s each"], ["Frog stretch", "2×60s"], ["Lizard stretch", "60s each"]] },
                                cooldown: { title: "Stretch (10 min)", exercises: [["Quad stretch", "60s each"], ["Hamstring stretch", "60s each"]] }
                            },
                            tips: ["Step intervals build anaerobic capacity", "Hip flexibility after steps keeps you loose", "Keep upright—don't lean on the rails"]
                        },
                        {
                            day: "Thursday",
                            type: "gym",
                            typeLabel: "Gym Day",
                            title: "Front Squats + Reverse Nordics",
                            duration: "60 min",
                            dietType: "Training Day",
                            workout: {
                                warmup: { title: "Warm-up (10 min)", exercises: [["Foam rolling", ""], ["Goblet squats", ""], ["Wrist stretches", ""]] },
                                main: { title: "Front Squat Focus (30 min)", exercises: [["Front Squat", "5×5"], ["Pause Front Squat", "3×5"], ["Goblet Squats", "3×10"]] },
                                posterior: { title: "Posterior Work (15 min)", exercises: [["Reverse Nordics", "4×8"], ["Nordic Curl Negatives", "3×5"], ["Hip Thrusts", "3×10"]] },
                                cooldown: { title: "Stretch (5 min)", exercises: [["Quad stretch", ""], ["Hip flexor stretch", ""]] }
                            },
                            tips: ["Front squats build Olympic lift positions", "Keep elbows HIGH throughout", "Reverse Nordics protect knees"]
                        },
                        {
                            day: "Friday",
                            type: "gym",
                            typeLabel: "Gym Day",
                            title: "Conditioning Intervals",
                            duration: "50 min",
                            dietType: "Training Day",
                            workout: {
                                warmup: { title: "Warm-up (10 min)", exercises: [["Light cardio", ""], ["Dynamic stretches", ""]] },
                                main: { title: "Interval Training (35 min)", exercises: [["Rower: 500m intervals", "4 rounds"], ["Rest 2 min between", ""], ["Assault bike: 30s sprints", "6 rounds"], ["Rest 90s between", ""], ["Sled push/pull (if available)", "4×20m"]] },
                                cooldown: { title: "Stretch (5 min)", exercises: [["Full body stretch", ""]] }
                            },
                            tips: ["Push hard on work intervals", "Full recovery between sets", "This builds work capacity"]
                        },
                        {
                            day: "Saturday",
                            type: "cardio",
                            typeLabel: "Cardio",
                            title: "Cycling + Foot Strength",
                            duration: "50 min",
                            dietType: "Active Day",
                            workout: {
                                main: { title: "Cycling (35-40 min)", exercises: [["Zone 2 steady state", ""], ["Include some moderate hills", ""], ["Heart rate 60-70% max", ""]] },
                                footwork: { title: "Foot Strengthening (10 min)", exercises: [["Toe curls", "3×15"], ["Arch lifts", "3×12"], ["Calf raises", "3×15"], ["Single-leg balance", "60s each"]] }
                            },
                            tips: ["Active recovery through movement", "Cycling prepares legs for next week", "Mental recovery matters too"]
                        },
                        {
                            day: "Sunday",
                            type: "recovery",
                            typeLabel: "Recovery",
                            title: "Full Body Mobility",
                            duration: "40 min",
                            dietType: "Recovery Day",
                            workout: {
                                main: { title: "Full Body Flow (40 min)", exercises: [["Cat-cow", "2 min"], ["Thread the needle", "10 each"], ["World's greatest stretch", "5 each"], ["Hip 90/90", "3 min"], ["Shoulder CARs", "10 each"], ["Ankle mobility", "2 min each"]] }
                            },
                            tips: ["Move through every joint", "Prep for integration week", "Sleep well tonight"]
                        }
                    ]
                },
                {
                    name: "Integration",
                    theme: "integration",
                    days: [
                        {
                            day: "Monday",
                            type: "gym",
                            typeLabel: "Gym Day",
                            title: "Lower Body Complex (Squat + DL)",
                            duration: "70 min",
                            dietType: "Training Day",
                            workout: {
                                warmup: { title: "Warm-up (10 min)", exercises: [["Foam rolling", ""], ["Dynamic stretches", ""], ["Light squats and hinges", ""]] },
                                main: { title: "Compound Lifts (40 min)", exercises: [["Back Squat", "4×5"], ["Deadlift", "4×5"], ["Walking Lunges", "3×10/leg"], ["Romanian Deadlift", "3×8"]] },
                                finisher: { title: "Finisher (10 min)", exercises: [["KB Swings", "4×15"], ["Box Jumps", "3×5"]] },
                                cooldown: { title: "Stretch (10 min)", exercises: [["Full lower body stretch", ""]] }
                            },
                            tips: ["This combines everything learned", "Manage fatigue—drop weight if needed", "Quality over ego"]
                        },
                        {
                            day: "Tuesday",
                            type: "gym",
                            typeLabel: "Gym Day",
                            title: "Push Press + Upper Strength",
                            duration: "60 min",
                            dietType: "Training Day",
                            workout: {
                                warmup: { title: "Warm-up (10 min)", exercises: [["Shoulder mobility", ""], ["Light pressing", ""], ["Jump shrugs", ""]] },
                                main: { title: "Press Work (35 min)", exercises: [["Push Press", "5×5"], ["Strict Press", "3×8"], ["Bench Press", "4×8"], ["Bent Over Rows", "4×10"]] },
                                accessory: { title: "Accessory (10 min)", exercises: [["Lateral Raises", "3×12"], ["Face Pulls", "3×15"]] },
                                cooldown: { title: "Stretch (5 min)", exercises: [["Chest and shoulder stretch", ""]] }
                            },
                            tips: ["Push press uses leg drive—dip and drive!", "Keep core tight on all pressing", "Progress the push press slowly"]
                        },
                        {
                            day: "Wednesday",
                            type: "cardio",
                            typeLabel: "Cardio",
                            title: "Step Machine + Nordic Prep",
                            duration: "55 min",
                            dietType: "Active Day",
                            workout: {
                                main: { title: "Step Machine (25 min)", exercises: [["Stair climber steady state", "15 min Zone 2"], ["Double-step intervals (skip a step)", "5 rounds of 1 min"], ["Cool-down pace", "5 min"]] },
                                nordic: { title: "Nordic Prep (15 min)", exercises: [["Nordic negatives", "3×5 (slow)"], ["Reverse Nordic holds", "3×20s"], ["Hamstring curls", "3×12"]] },
                                hipflexor: { title: "Hip Flexor Stretch (10 min)", exercises: [["Couch stretch", "90s each"], ["Lunge with reach", "2×8 each"], ["Pigeon", "60s each"]] },
                                cooldown: { title: "Stretch (5 min)", exercises: [["Quad stretch", "60s each"], ["Calf stretch", "60s each"]] }
                            },
                            tips: ["Step machine warms up legs for Nordic prep", "Double-step intervals build power", "Nordic prep prevents DOMS for Friday hamstring day"]
                        },
                        {
                            day: "Thursday",
                            type: "gym",
                            typeLabel: "Gym Day",
                            title: "Full Olympic Complex",
                            duration: "65 min",
                            dietType: "Training Day",
                            workout: {
                                warmup: { title: "Warm-up (15 min)", exercises: [["Jump rope", "3 min"], ["Empty bar complex", "3 rounds"], ["Muscle cleans", "5 reps"]] },
                                main: { title: "Olympic Work (35 min)", exercises: [["Clean Pulls", "3×3"], ["Power Cleans", "5×3"], ["Front Squat", "3×5"], ["Push Press", "3×5"]] },
                                accessory: { title: "Accessory (10 min)", exercises: [["RDL", "3×8"], ["Shrugs", "3×10"]] },
                                cooldown: { title: "Stretch (5 min)", exercises: [["Full body stretch", ""]] }
                            },
                            tips: ["This is the culmination of Week 3's work", "Stay light—technique over weight", "Full extension on every pull"]
                        },
                        {
                            day: "Friday",
                            type: "gym",
                            typeLabel: "Gym Day",
                            title: "Hamstring & Posterior Chain",
                            duration: "55 min",
                            dietType: "Training Day",
                            workout: {
                                warmup: { title: "Warm-up (10 min)", exercises: [["Light RDLs", ""], ["Hip hinges", ""], ["Glute bridges", ""]] },
                                main: { title: "Posterior Chain (35 min)", exercises: [["Nordic Curls", "4×5"], ["Reverse Nordics", "3×10"], ["Romanian Deadlift", "4×8"], ["Hip Thrusts", "3×12"], ["Good Mornings", "3×10"]] },
                                finisher: { title: "Finisher (5 min)", exercises: [["KB Swings", "50 total"], ["Split any way", ""]] },
                                cooldown: { title: "Stretch (5 min)", exercises: [["Hamstring stretch", ""], ["Glute stretch", ""]] }
                            },
                            tips: ["Full Nordic curls are the goal—get there gradually", "This builds bulletproof hamstrings", "Last gym day before deload"]
                        },
                        {
                            day: "Saturday",
                            type: "cardio",
                            typeLabel: "Cardio",
                            title: "Cycling + Foot Strengthening",
                            duration: "50 min",
                            dietType: "Active Day",
                            workout: {
                                main: { title: "Cycling (35-40 min)", exercises: [["Zone 2 steady ride", "30 min"], ["Pick a scenic route", ""], ["Easy spin cool-down", "5 min"]] },
                                footwork: { title: "Foot Strengthening (10 min)", exercises: [["Toe curls", "3×15"], ["Arch lifts", "3×12"], ["Calf raises", "3×15"], ["Balance work", "3 min"]] }
                            },
                            tips: ["Week 4 complete—enjoy the ride!", "Keep it Zone 2—celebrate with movement", "Cycling flushes legs before starting the cycle again"]
                        },
                        {
                            day: "Sunday",
                            type: "recovery",
                            typeLabel: "Recovery",
                            title: "Active Recovery + Mobility",
                            duration: "35 min",
                            dietType: "Recovery Day",
                            workout: {
                                main: { title: "Active Recovery (35 min)", exercises: [["Light walking", "10 min"], ["Full body stretch", "15 min"], ["Meditation/breathing", "10 min"]] }
                            },
                            tips: ["Week 4 complete—back to Foundation!", "Reflect on progress made", "Sleep well, eat well, recover fully"]
                        }
                    ]
                }
            ]
        };

        const nutritionByDay = [
            {
                summary: "High carb day to fuel lower body power work. Focus on complex carbs around training.",
                calories: "2,600-2,800",
                dietType: "Training Day",
                meals: [
                    { name: "Breakfast", time: "7:00 AM", protein: "35g", content: "Scrambled eggs with vegetables & whole grain toast", image: "https://images.unsplash.com/photo-1525351484163-7529414344d8?w=400&h=300&fit=crop", recipe: { title: "Power Scramble", ingredients: ["3 whole eggs + 2 egg whites", "1 cup spinach", "½ cup mushrooms", "2 slices whole grain bread", "½ avocado"], instructions: "Sauté spinach and mushrooms. Scramble eggs and combine. Serve with toast and avocado." }, alternatives: ["Greek yogurt parfait with granola", "Protein oatmeal with banana"] },
                    { name: "Lunch", time: "12:30 PM", protein: "45g", content: "Grilled chicken breast with rice and roasted vegetables", image: "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=400&h=300&fit=crop", recipe: { title: "Chicken Power Bowl", ingredients: ["180g chicken breast", "1 cup brown rice", "1 cup broccoli", "1 cup bell peppers", "1 tbsp olive oil", "Herbs & spices"], instructions: "Season and grill chicken. Roast vegetables at 200°C for 20 min. Serve over rice with olive oil drizzle." }, alternatives: ["Salmon with quinoa", "Turkey meatballs with pasta"] },
                    { name: "Post-Gym", time: "Within 30 min", protein: "30g", content: "Protein shake with banana and oats", image: "https://images.unsplash.com/photo-1622485831930-8d9c9d2f0bf9?w=400&h=300&fit=crop", recipe: { title: "Recovery Shake", ingredients: ["1 scoop whey protein", "1 banana", "30g oats", "250ml milk or water", "1 tbsp peanut butter (optional)"], instructions: "Blend all ingredients until smooth. Drink within 30 minutes of training." }, alternatives: ["Chocolate milk + protein bar", "Greek yogurt with honey"] },
                    { name: "Dinner", time: "7:00 PM", protein: "45g", content: "Lean beef stir-fry with noodles and vegetables", image: "https://images.unsplash.com/photo-1512058564366-18510be2db19?w=400&h=300&fit=crop", recipe: { title: "Beef Stir-Fry", ingredients: ["180g lean beef strips", "150g egg noodles", "1 cup mixed vegetables", "2 tbsp soy sauce", "1 tbsp sesame oil", "Garlic & ginger"], instructions: "Cook noodles. Stir-fry beef with garlic and ginger. Add vegetables, sauce, and noodles. Toss and serve." }, alternatives: ["Grilled fish with sweet potato", "Chicken pasta with tomato sauce"] }
                ],
                snacks: [{ name: "Mid-morning", suggestion: "Apple + 20 almonds", calories: "~200" }, { name: "Pre-workout", suggestion: "Rice cakes with honey", calories: "~150" }]
            },
            {
                summary: "Moderate carb day. Prioritize protein for muscle recovery after upper body work.",
                calories: "2,500-2,700",
                dietType: "Training Day",
                meals: [
                    { name: "Breakfast", time: "7:00 AM", protein: "40g", content: "Greek yogurt parfait with protein granola", image: "https://images.unsplash.com/photo-1488477181946-6428a0291777?w=400&h=300&fit=crop", recipe: { title: "Protein Parfait", ingredients: ["250g Greek yogurt (0% fat)", "1 scoop protein powder", "50g granola", "100g mixed berries", "1 tbsp honey"], instructions: "Mix protein powder into yogurt. Layer with granola and berries. Drizzle with honey." }, alternatives: ["Cottage cheese with fruit", "Protein pancakes"] },
                    { name: "Lunch", time: "12:30 PM", protein: "40g", content: "Tuna salad with quinoa and chickpeas", image: "https://images.unsplash.com/photo-1512621776951-a57141f2eefd?w=400&h=300&fit=crop", recipe: { title: "Mediterranean Tuna Bowl", ingredients: ["150g tuna (canned or fresh)", "1 cup cooked quinoa", "½ cup chickpeas", "Cherry tomatoes, cucumber, red onion", "2 tbsp olive oil", "Lemon juice, herbs"], instructions: "Combine quinoa and chickpeas. Top with tuna and vegetables. Dress with olive oil and lemon." }, alternatives: ["Chicken Caesar salad", "Turkey wrap with hummus"] },
                    { name: "Post-Gym", time: "Within 30 min", protein: "30g", content: "Protein shake with berries", image: "https://images.unsplash.com/photo-1553530666-ba11a7da3888?w=400&h=300&fit=crop", recipe: { title: "Berry Blast Shake", ingredients: ["1 scoop whey protein", "100g mixed berries", "250ml almond milk", "Ice cubes"], instructions: "Blend all ingredients until smooth." }, alternatives: ["Protein bar + banana", "Chocolate milk"] },
                    { name: "Dinner", time: "7:00 PM", protein: "45g", content: "Grilled salmon with roasted sweet potato and asparagus", image: "https://images.unsplash.com/photo-1467003909585-2f8a72700288?w=400&h=300&fit=crop", recipe: { title: "Omega-3 Power Plate", ingredients: ["180g salmon fillet", "1 medium sweet potato", "150g asparagus", "1 tbsp olive oil", "Lemon, dill, garlic"], instructions: "Roast sweet potato at 200°C for 25 min. Season salmon and bake for 12-15 min. Grill asparagus with olive oil." }, alternatives: ["Chicken thighs with vegetables", "Shrimp stir-fry with rice"] }
                ],
                snacks: [{ name: "Mid-morning", suggestion: "Cottage cheese + pineapple", calories: "~180" }, { name: "Evening", suggestion: "Casein shake or Greek yogurt", calories: "~150" }]
            },
            {
                summary: "Lower carb recovery day. Focus on anti-inflammatory foods and hydration.",
                calories: "2,400-2,600",
                dietType: "Recovery Day",
                meals: [
                    { name: "Breakfast", time: "7:00 AM", protein: "35g", content: "Omelette with vegetables and avocado", image: "https://images.unsplash.com/photo-1525351484163-7529414344d8?w=400&h=300&fit=crop", recipe: { title: "Veggie Omelette", ingredients: ["3 whole eggs", "½ cup spinach", "¼ cup tomatoes", "¼ cup feta cheese", "½ avocado", "Fresh herbs"], instructions: "Whisk eggs. Cook vegetables in pan, pour eggs over. Fold when set. Serve with avocado." }, alternatives: ["Smoked salmon with eggs", "Protein smoothie bowl"] },
                    { name: "Lunch", time: "12:30 PM", protein: "40g", content: "Large salad with grilled chicken and olive oil dressing", image: "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=400&h=300&fit=crop", recipe: { title: "Recovery Salad Bowl", ingredients: ["150g grilled chicken", "Mixed greens", "Cucumber, tomatoes, red onion", "¼ cup walnuts", "2 tbsp olive oil", "Balsamic vinegar"], instructions: "Grill and slice chicken. Combine salad ingredients. Dress with olive oil and balsamic." }, alternatives: ["Beef salad with greens", "Shrimp avocado bowl"] },
                    { name: "Snack", time: "3:30 PM", protein: "25g", content: "Greek yogurt with nuts and seeds", image: "https://images.unsplash.com/photo-1488477181946-6428a0291777?w=400&h=300&fit=crop", recipe: { title: "Protein Snack Bowl", ingredients: ["200g Greek yogurt", "1 tbsp mixed seeds", "10 almonds", "Cinnamon"], instructions: "Top yogurt with nuts, seeds, and cinnamon." }, alternatives: ["Protein shake", "Cottage cheese with berries"] },
                    { name: "Dinner", time: "7:00 PM", protein: "45g", content: "Baked cod with Mediterranean vegetables", image: "https://images.unsplash.com/photo-1519708227418-c8fd9a32b7a2?w=400&h=300&fit=crop", recipe: { title: "Mediterranean Fish", ingredients: ["180g cod fillet", "1 cup zucchini", "1 cup eggplant", "Cherry tomatoes", "Olives", "2 tbsp olive oil", "Herbs"], instructions: "Roast vegetables at 200°C for 20 min. Season cod and bake for 12 min. Serve together with herbs." }, alternatives: ["Turkey meatballs with vegetables", "Chicken with roasted vegetables"] }
                ],
                snacks: [{ name: "Mid-morning", suggestion: "Handful of mixed nuts", calories: "~170" }, { name: "Evening", suggestion: "Herbal tea + small dark chocolate", calories: "~80" }]
            },
            {
                summary: "High energy day for demanding work. Extra carbs pre and post workout.",
                calories: "2,700-2,900",
                dietType: "Training Day",
                meals: [
                    { name: "Breakfast", time: "7:00 AM", protein: "35g", content: "Protein oatmeal with banana and peanut butter", image: "https://images.unsplash.com/photo-1517673400267-0251440c45dc?w=400&h=300&fit=crop", recipe: { title: "Power Oatmeal", ingredients: ["60g oats", "1 scoop protein powder", "1 banana", "2 tbsp peanut butter", "250ml milk", "Cinnamon"], instructions: "Cook oats with milk. Stir in protein powder. Top with sliced banana and peanut butter." }, alternatives: ["Eggs with toast and fruit", "Protein pancakes with syrup"] },
                    { name: "Lunch", time: "12:30 PM", protein: "45g", content: "Turkey and rice bowl with black beans", image: "https://images.unsplash.com/photo-1543339308-43e59d6b73a6?w=400&h=300&fit=crop", recipe: { title: "Tex-Mex Power Bowl", ingredients: ["180g ground turkey", "1 cup rice", "½ cup black beans", "Corn, peppers, onion", "Salsa", "Greek yogurt (sour cream alternative)"], instructions: "Cook turkey with taco seasoning. Serve over rice with beans and toppings." }, alternatives: ["Chicken burrito bowl", "Beef and rice plate"] },
                    { name: "Post-Gym", time: "Within 30 min", protein: "35g", content: "Protein shake with banana and honey", image: "https://images.unsplash.com/photo-1622485831930-8d9c9d2f0bf9?w=400&h=300&fit=crop", recipe: { title: "Recovery Shake", ingredients: ["1.5 scoops whey protein", "1 banana", "1 tbsp honey", "300ml milk", "Ice"], instructions: "Blend until smooth." }, alternatives: ["Mass gainer shake", "Greek yogurt + granola + fruit"] },
                    { name: "Dinner", time: "7:00 PM", protein: "45g", content: "Chicken thighs with roasted potatoes and green beans", image: "https://images.unsplash.com/photo-1598515214211-89d3c73ae83b?w=400&h=300&fit=crop", recipe: { title: "Classic Chicken Dinner", ingredients: ["200g chicken thighs (skin optional)", "200g baby potatoes", "150g green beans", "2 tbsp olive oil", "Rosemary, garlic, lemon"], instructions: "Roast chicken and potatoes at 200°C for 35 min. Steam or roast green beans. Season with herbs." }, alternatives: ["Steak with mashed potatoes", "Pork tenderloin with rice"] }
                ],
                snacks: [{ name: "Mid-morning", suggestion: "Banana + protein bar", calories: "~300" }, { name: "Pre-workout", suggestion: "Rice cakes with jam", calories: "~150" }]
            },
            {
                summary: "End of training week. Good carbs for explosive work, moderate evening.",
                calories: "2,500-2,700",
                dietType: "Training Day",
                meals: [
                    { name: "Breakfast", time: "7:00 AM", protein: "35g", content: "Eggs benedict style with turkey bacon", image: "https://images.unsplash.com/photo-1608039829572-9b0b9b3b9b0b?w=400&h=300&fit=crop", recipe: { title: "Protein Eggs Benedict", ingredients: ["2 poached eggs", "1 English muffin", "3 slices turkey bacon", "Light hollandaise or Greek yogurt sauce", "Spinach"], instructions: "Toast muffin, cook turkey bacon, poach eggs. Layer with spinach and sauce." }, alternatives: ["Breakfast burrito", "French toast with eggs"] },
                    { name: "Lunch", time: "12:30 PM", protein: "40g", content: "Asian chicken noodle bowl", image: "https://images.unsplash.com/photo-1569718212165-3a8278d5f624?w=400&h=300&fit=crop", recipe: { title: "Teriyaki Chicken Noodles", ingredients: ["150g chicken breast", "150g rice noodles", "Broccoli, carrots, snap peas", "3 tbsp teriyaki sauce", "Sesame seeds", "Green onions"], instructions: "Cook noodles. Stir-fry chicken and vegetables. Combine with sauce and garnish." }, alternatives: ["Pho with beef", "Pad Thai with shrimp"] },
                    { name: "Post-Gym", time: "Within 30 min", protein: "30g", content: "Protein shake with dates", image: "https://images.unsplash.com/photo-1553530666-ba11a7da3888?w=400&h=300&fit=crop", recipe: { title: "Friday Finisher Shake", ingredients: ["1 scoop protein", "3 Medjool dates (pitted)", "250ml oat milk", "1 tbsp almond butter", "Ice"], instructions: "Blend until smooth. Dates provide quick carbs for recovery." }, alternatives: ["Chocolate protein shake", "Recovery smoothie"] },
                    { name: "Dinner", time: "7:00 PM", protein: "45g", content: "Lean steak with baked potato and salad", image: "https://images.unsplash.com/photo-1558030006-450675393462?w=400&h=300&fit=crop", recipe: { title: "Friday Steak Night", ingredients: ["180g sirloin steak", "1 medium baked potato", "Side salad", "1 tbsp butter (for potato)", "Herbs and seasoning"], instructions: "Season and grill steak to preference. Bake potato at 200°C for 45 min. Serve with fresh salad." }, alternatives: ["Lamb chops with vegetables", "Salmon with quinoa"] }
                ],
                snacks: [{ name: "Mid-morning", suggestion: "Trail mix (30g)", calories: "~180" }, { name: "Pre-workout", suggestion: "Small banana", calories: "~90" }]
            },
            {
                summary: "Lower carb weekend day. Protein stays high, flexibility for one social meal.",
                calories: "2,300-2,500",
                dietType: "Weekend",
                meals: [
                    { name: "Breakfast", time: "8:30 AM", protein: "35g", content: "Weekend omelette with smoked salmon", image: "https://images.unsplash.com/photo-1525351484163-7529414344d8?w=400&h=300&fit=crop", recipe: { title: "Smoked Salmon Omelette", ingredients: ["3 eggs", "60g smoked salmon", "2 tbsp cream cheese", "Chives", "Capers (optional)"], instructions: "Make fluffy omelette. Fill with cream cheese and salmon. Garnish with chives." }, alternatives: ["Avocado toast with eggs", "Shakshuka"] },
                    { name: "Lunch", time: "1:00 PM", protein: "40g", content: "Grilled chicken Greek salad", image: "https://images.unsplash.com/photo-1540189549336-e6e99c3679fe?w=400&h=300&fit=crop", recipe: { title: "Greek Power Salad", ingredients: ["150g grilled chicken", "Romaine lettuce", "Cucumber, tomatoes, red onion", "50g feta cheese", "Olives", "2 tbsp olive oil", "Oregano, lemon"], instructions: "Combine salad ingredients. Top with sliced chicken. Dress with olive oil and lemon." }, alternatives: ["Cobb salad", "Chicken Caesar"] },
                    { name: "Dinner", time: "7:00 PM", protein: "45g", content: "Flexible meal — social or home-cooked", image: "https://images.unsplash.com/photo-1414235077428-338989a2e8c0?w=400&h=300&fit=crop", recipe: { title: "Weekend Flexibility", ingredients: ["Choose protein-focused option at restaurant", "OR home-cooked lean protein + vegetables"], instructions: "If eating out: prioritize protein, limit bread/starters, skip dessert or share. At home: simple grilled protein with vegetables." }, alternatives: ["Sushi (sashimi-heavy)", "Grilled fish at restaurant", "BBQ with lean meats"] }
                ],
                snacks: [{ name: "Afternoon", suggestion: "Protein shake or Greek yogurt", calories: "~150" }]
            },
            {
                summary: "Meal prep day. Moderate intake, focus on setting up the week ahead.",
                calories: "2,300-2,500",
                dietType: "Weekend",
                meals: [
                    { name: "Breakfast", time: "9:00 AM", protein: "30g", content: "Leisurely protein breakfast", image: "https://images.unsplash.com/photo-1484723091739-30a097e8f929?w=400&h=300&fit=crop", recipe: { title: "Sunday Brunch Plate", ingredients: ["2 eggs (any style)", "2 turkey sausages", "Grilled tomatoes", "Sautéed mushrooms", "1 slice whole grain toast"], instructions: "Cook eggs to preference. Grill sausages and tomatoes. Sauté mushrooms. Enjoy a relaxed breakfast." }, alternatives: ["Protein smoothie bowl", "Cottage cheese pancakes"] },
                    { name: "Lunch", time: "1:30 PM", protein: "40g", content: "Meal prep cooking + taste testing", image: "https://images.unsplash.com/photo-1546069901-ba9599a7e63c?w=400&h=300&fit=crop", recipe: { title: "Meal Prep Session", ingredients: ["Batch cook: 500g chicken breast", "Batch cook: 3 cups rice or quinoa", "Roast: mixed vegetables", "Prep: salad ingredients", "Portion into containers"], instructions: "Spend 1-2 hours cooking proteins, carbs, and vegetables for the week. This saves time and ensures healthy options are ready." }, alternatives: ["Order healthy meal prep delivery", "Simple leftover lunch"] },
                    { name: "Dinner", time: "6:30 PM", protein: "45g", content: "Light dinner to prepare for Monday", image: "https://images.unsplash.com/photo-1467003909585-2f8a72700288?w=400&h=300&fit=crop", recipe: { title: "Pre-Week Light Dinner", ingredients: ["150g baked fish (cod, tilapia, or salmon)", "Large portion roasted vegetables", "Small portion quinoa or rice (optional)", "Lemon and herbs"], instructions: "Keep dinner light to sleep well and wake up ready for Monday's training." }, alternatives: ["Soup with protein", "Chicken stir-fry (light on oil)"] }
                ],
                snacks: [{ name: "Afternoon", suggestion: "Herbal tea + small handful of nuts", calories: "~120" }]
            }
        ];

        function getDayOfWeek(date) {
            return date.getDay() === 0 ? 6 : date.getDay() - 1;
        }

        function getWeekNumber(date) {
            const diffTime = date - PROGRAM_START_DATE;
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            let weekNum = Math.floor(diffDays / 7) % 4;
            if (weekNum < 0) weekNum += 4;
            return weekNum;
        }

        function getDayData(date) {
            const weekNum = getWeekNumber(date);
            const dayOfWeek = getDayOfWeek(date);
            if (!monthlyProgram.weeks[weekNum]) {
                console.error('Invalid weekNum:', weekNum, 'for date:', date);
                console.log('monthlyProgram.weeks length:', monthlyProgram.weeks.length);
                return monthlyProgram.weeks[0].days[dayOfWeek];
            }
            return monthlyProgram.weeks[weekNum].days[dayOfWeek];
        }

        function getNutritionForDay(date) {
            const dayOfWeek = getDayOfWeek(date);
            return nutritionByDay[dayOfWeek];
        }

        function getMonthName(month) {
            const months = ["January", "February", "March", "April", "May", "June", "July", "August", "September", "October", "November", "December"];
            return months[month];
        }

        function getDaysInMonth(year, month) {
            return new Date(year, month + 1, 0).getDate();
        }

        function getFirstDayOfMonth(year, month) {
            const day = new Date(year, month, 1).getDay();
            return day === 0 ? 6 : day - 1;
        }

        function updateWeekIndicator(date) {
            const weekNum = getWeekNumber(date);
            const theme = weekThemes[weekNum];
            const badge = document.getElementById('current-week-badge');
            const themeText = document.getElementById('current-week-theme');
            badge.textContent = `W${weekNum + 1}`;
            badge.className = `week-badge week-${weekNum + 1}`;
            themeText.textContent = `${theme.name} Week`;
        }

        function renderMonthCalendar() {
            const grid = document.getElementById('calendar');
            const daysInMonth = getDaysInMonth(currentYear, currentMonth);
            const firstDay = getFirstDayOfMonth(currentYear, currentMonth);
            const today = new Date();

            document.getElementById('month-title').textContent = `${getMonthName(currentMonth)} ${currentYear}`;
            updateWeekIndicator(new Date(currentYear, currentMonth, 15));

            const dayHeaders = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
            let html = dayHeaders.map(d => `<div class="calendar-day-header">${d}</div>`).join('');

            for (let i = 0; i < firstDay; i++) {
                html += '<div class="calendar-cell empty"></div>';
            }

            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(currentYear, currentMonth, day);
                const dayData = getDayData(date);
                const weekNum = getWeekNumber(date);
                const isToday = date.toDateString() === today.toDateString();

                html += `
                    <div class="calendar-cell ${isToday ? 'today' : ''}" onclick="openModal(new Date(${currentYear}, ${currentMonth}, ${day}))">
                        <div class="calendar-date">${day}</div>
                        <span class="calendar-week-badge week-badge week-${weekNum + 1}">W${weekNum + 1}</span>
                        <div class="calendar-workout-type ${dayData.type}">${dayData.typeLabel}</div>
                        <div class="calendar-workout-title">${dayData.title}</div>
                    </div>
                `;
            }

            const totalCells = firstDay + daysInMonth;
            const remainingCells = (7 - (totalCells % 7)) % 7;
            for (let i = 0; i < remainingCells; i++) {
                html += '<div class="calendar-cell empty"></div>';
            }

            grid.innerHTML = html;
        }

        function previousMonth() {
            currentMonth--;
            if (currentMonth < 0) {
                currentMonth = 11;
                currentYear--;
            }
            renderMonthCalendar();
        }

        function nextMonth() {
            currentMonth++;
            if (currentMonth > 11) {
                currentMonth = 0;
                currentYear++;
            }
            renderMonthCalendar();
        }

        function goToToday() {
            const today = new Date();
            currentYear = today.getFullYear();
            currentMonth = today.getMonth();
            renderMonthCalendar();
        }

        function openModal(dateOrIndex) {
            let day, nutrition, recipeId;
            if (dateOrIndex instanceof Date) {
                day = getDayData(dateOrIndex);
                nutrition = getNutritionForDay(dateOrIndex);
                const weekNum = getWeekNumber(dateOrIndex);
                recipeId = dateOrIndex.getTime();
                const dateStr = dateOrIndex.toLocaleDateString('en-US', { weekday: 'long', month: 'long', day: 'numeric' });
                document.getElementById('modal-title').innerHTML = `${dateStr} <span class="day-type ${day.type}" style="margin-left: 1rem;">${day.typeLabel}</span> <span class="week-badge week-${weekNum + 1}" style="margin-left: 0.5rem; font-size: 0.7rem;">W${weekNum + 1}</span>`;
            } else {
                day = monthlyProgram.weeks[0].days[dateOrIndex];
                nutrition = nutritionByDay[dateOrIndex];
                recipeId = dateOrIndex;
                document.getElementById('modal-title').innerHTML = `${day.day} <span class="day-type ${day.type}" style="margin-left: 1rem;">${day.typeLabel}</span>`;
            }
            
            let workoutHTML = '';
            for (const [key, block] of Object.entries(day.workout)) {
                workoutHTML += `
                    <div class="workout-block">
                        <div class="workout-block-title">${block.title}</div>
                        <ul class="exercise-list">
                            ${block.exercises.map(ex => `<li><span>${ex[0]}</span><span>${ex[1]}</span></li>`).join('')}
                        </ul>
                    </div>
                `;
            }

            // New expanded nutrition rendering
            const nutritionSummaryHTML = nutrition.summary ? `
                <div class="nutrition-summary">
                    <p>${nutrition.summary}</p>
                    ${nutrition.calories ? `<span class="calories-badge">📊 ${nutrition.calories} kcal target</span>` : ''}
                </div>
            ` : '';

            const mealsHTML = nutrition.meals.map((meal, mealIndex) => `
                <div class="meal-card">
                    ${meal.image ? `<img src="${meal.image}" alt="${meal.name}" class="meal-image" loading="lazy" onerror="this.style.display='none'">` : ''}
                    <div class="meal-card-content">
                        <div class="meal-card-header">
                            <div>
                                <div class="meal-card-title">${meal.name}</div>
                                ${meal.time ? `<div class="meal-card-time">${meal.time}</div>` : ''}
                            </div>
                            <span class="meal-card-protein">${meal.protein} protein</span>
                        </div>
                        <div class="meal-card-description">${meal.content}</div>
                        ${meal.recipe ? `
                            <button class="recipe-toggle" onclick="toggleRecipe(this, '${recipeId}', ${mealIndex})">
                                <span>📖 View Recipe & Ingredients</span>
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <polyline points="6 9 12 15 18 9"></polyline>
                                </svg>
                            </button>
                            <div class="recipe-content" id="recipe-${recipeId}-${mealIndex}">
                                <div class="recipe-title">${meal.recipe.title}</div>
                                <div class="recipe-section-title">Ingredients</div>
                                <ul class="ingredients-list">
                                    ${meal.recipe.ingredients.map(ing => `<li>${ing}</li>`).join('')}
                                </ul>
                                <div class="recipe-section-title">Instructions</div>
                                <p class="recipe-instructions">${meal.recipe.instructions}</p>
                                ${meal.alternatives ? `
                                    <div class="alternatives">
                                        <div class="alternatives-title">Quick Alternatives</div>
                                        <div class="alternatives-list">${meal.alternatives.join(' • ')}</div>
                                    </div>
                                ` : ''}
                            </div>
                        ` : ''}
                    </div>
                </div>
            `).join('');

            const snacksHTML = nutrition.snacks ? `
                <div class="snacks-section">
                    <div class="snacks-title">🥜 Snacks</div>
                    ${nutrition.snacks.map(snack => `
                        <div class="snack-item">
                            <div>
                                <span class="snack-name">${snack.name}:</span>
                                <span class="snack-suggestion">${snack.suggestion}</span>
                            </div>
                            <span class="snack-calories">${snack.calories}</span>
                        </div>
                    `).join('')}
                </div>
            ` : '';

            const tipsHTML = day.tips.map(tip => `
                <div class="tip">
                    <span class="tip-icon">💡</span>
                    <span>${tip}</span>
                </div>
            `).join('');

            document.getElementById('modal-body').innerHTML = `
                <div class="section">
                    <div class="section-header">
                        <div class="section-icon workout">
                            <svg viewBox="0 0 24 24"><path d="M20.57 14.86L22 13.43 20.57 12 17 15.57 8.43 7 12 3.43 10.57 2 9.14 3.43 7.71 2 5.57 4.14 4.14 2.71 2.71 4.14l1.43 1.43L2 7.71l1.43 1.43L2 10.57 3.43 12 7 8.43 15.57 17 12 20.57 13.43 22l1.43-1.43L16.29 22l2.14-2.14 1.43 1.43 1.43-1.43-1.43-1.43L22 16.29z"/></svg>
                        </div>
                        <span class="section-title">Workout — ${day.duration}</span>
                    </div>
                    ${workoutHTML}
                </div>
                <div class="section nutrition-section">
                    <div class="section-header">
                        <div class="section-icon nutrition">
                            <svg viewBox="0 0 24 24"><path d="M18.06 22.99h1.66c.84 0 1.53-.64 1.63-1.46L23 5.05l-5 2V1h-2v8l-5-2 1.66 16.48c.09.82.78 1.46 1.63 1.46h1.66L14 18h6l-1.94 4.99zM9 22v-2H7v2h2zm-5-2v2h2v-2H4zm9.86-10.27L12 5.27 4 8.5V11h2.3l-.3 1h-2l-.3 1h2.3L5 16h2l1-3h4l1 3h2l-1-3h2.3l-.3-1h-2l-.3-1H16V8.5l-2.14.73z"/></svg>
                        </div>
                        <span class="section-title">${day.dietType} Nutrition</span>
                    </div>
                    ${nutritionSummaryHTML}
                    ${mealsHTML}
                    ${snacksHTML}
                </div>
                <div class="section tips-section">
                    <div class="section-header">
                        <div class="section-icon">
                            <svg viewBox="0 0 24 24"><path d="M9 21c0 .5.4 1 1 1h4c.6 0 1-.5 1-1v-1H9v1zm3-19C8.1 2 5 5.1 5 9c0 2.4 1.2 4.5 3 5.7V17c0 .5.4 1 1 1h6c.6 0 1-.5 1-1v-2.3c1.8-1.3 3-3.4 3-5.7 0-3.9-3.1-7-7-7z"/></svg>
                        </div>
                        <span class="section-title">Tips & Hints</span>
                    </div>
                    <div class="tips-list">
                        ${tipsHTML}
                    </div>
                </div>
            `;

            document.getElementById('modal').classList.add('active');
            document.body.classList.add('modal-open');
            document.body.style.overflow = 'hidden';
        }

        function toggleRecipe(button, dayIndex, mealIndex) {
            const recipeContent = document.getElementById(`recipe-${dayIndex}-${mealIndex}`);
            button.classList.toggle('active');
            recipeContent.classList.toggle('active');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('active');
            document.body.classList.remove('modal-open');
            document.body.style.overflow = '';
        }

        // Golden Rules Modal Functions
        function openGoldenRulesModal(ruleNumber) {
            const modal = document.getElementById('rules-modal');
            const modalBody = document.getElementById('rules-modal-body');

            modal.classList.add('active');
            document.body.classList.add('modal-open');
            document.body.style.overflow = 'hidden';

            // If a specific rule number is provided, scroll to it
            if (ruleNumber) {
                // Small delay to ensure modal is rendered
                setTimeout(() => {
                    const ruleElement = document.getElementById(`golden-rule-${ruleNumber}`);
                    if (ruleElement && modalBody) {
                        // Scroll the modal body to the rule
                        const ruleTop = ruleElement.offsetTop - 20;
                        modalBody.scrollTo({
                            top: ruleTop,
                            behavior: 'smooth'
                        });

                        // Add a brief highlight effect
                        ruleElement.style.transition = 'box-shadow 0.3s ease';
                        ruleElement.style.boxShadow = '0 0 0 3px var(--accent-orange), 0 4px 20px rgba(232, 93, 37, 0.3)';
                        setTimeout(() => {
                            ruleElement.style.boxShadow = '';
                        }, 1500);
                    }
                }, 100);
            } else {
                // Reset scroll position when opening without a specific rule
                if (modalBody) {
                    modalBody.scrollTop = 0;
                }
            }
        }

        function closeGoldenRulesModal() {
            document.getElementById('rules-modal').classList.remove('active');
            document.body.classList.remove('modal-open');
            document.body.style.overflow = '';
        }

        // Close golden rules modal on overlay click
        document.getElementById('rules-modal').addEventListener('click', (e) => {
            if (e.target.id === 'rules-modal') {
                closeGoldenRulesModal();
            }
        });

        // Close modal on overlay click
        document.getElementById('modal').addEventListener('click', (e) => {
            if (e.target.id === 'modal') {
                closeModal();
            }
        });

        // Close on escape
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') {
                closeModal();
                closeGoldenRulesModal();
            }
        });

        // Initialize
        const today = new Date();
        currentYear = today.getFullYear();
        currentMonth = today.getMonth();
        renderMonthCalendar();

        // Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registered:', registration.scope);
                    })
                    .catch(error => {
                        console.log('ServiceWorker registration failed:', error);
                    });
            });
        }

        // PWA Install Prompt
        let deferredPrompt;
        const installBanner = document.getElementById('install-banner');
        const installBtn = document.getElementById('install-btn');
        const dismissBtn = document.getElementById('dismiss-btn');

        function isStandalone() {
            return window.matchMedia('(display-mode: standalone)').matches
                || window.navigator.standalone === true
                || document.referrer.includes('android-app://');
        }

        function hideInstallBanner() {
            if (installBanner) {
                installBanner.classList.remove('show');
                installBanner.style.display = 'none';
            }
        }

        if (isStandalone() || localStorage.getItem('appInstalled') === 'true') {
            hideInstallBanner();
        } else {
            window.addEventListener('beforeinstallprompt', (e) => {
                e.preventDefault();
                deferredPrompt = e;
                if (installBanner && localStorage.getItem('installDismissed') !== 'true') {
                    installBanner.classList.add('show');
                }
            });
        }

        if (installBtn) {
            installBtn.addEventListener('click', async () => {
                if (deferredPrompt) {
                    deferredPrompt.prompt();
                    const { outcome } = await deferredPrompt.userChoice;
                    deferredPrompt = null;
                    if (outcome === 'accepted') {
                        localStorage.setItem('appInstalled', 'true');
                    }
                    hideInstallBanner();
                }
            });
        }

        if (dismissBtn) {
            dismissBtn.addEventListener('click', () => {
                hideInstallBanner();
                localStorage.setItem('installDismissed', 'true');
            });
        }

        window.addEventListener('appinstalled', () => {
            localStorage.setItem('appInstalled', 'true');
            hideInstallBanner();
        });

        // Offline detection
        const offlineIndicator = document.getElementById('offline-indicator');
        
        function updateOnlineStatus() {
            if (!navigator.onLine) {
                offlineIndicator.classList.add('show');
            } else {
                offlineIndicator.classList.remove('show');
            }
        }

        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
        updateOnlineStatus();
    </script>
</body>
</html>
